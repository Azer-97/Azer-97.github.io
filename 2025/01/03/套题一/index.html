<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>区块链 套题一 | Azer</title><meta name="author" content="阿泽"><meta name="copyright" content="阿泽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="套题一区块链食品溯源系统概要设计说明书1．引言1.1编写目的本概要说明书按照《需求规格说明书》的功能需求，设计本系统的软件结构，供后续软件过程(详细设计等)做依据，预期读者为后续软件过程的设计、开发人员。 2. 总体设计2.1需求规定2.1.2输入输出要求参照需求文档的说明 2.2运行环境本系统必须运行在局域网或互联网中 2.2.1支持架构客户端 服务器端 后台数据库 2.3基本设计概念和处理流程">
<meta property="og:type" content="article">
<meta property="og:title" content="区块链 套题一">
<meta property="og:url" content="http://example.com/2025/01/03/%E5%A5%97%E9%A2%98%E4%B8%80/index.html">
<meta property="og:site_name" content="Azer">
<meta property="og:description" content="套题一区块链食品溯源系统概要设计说明书1．引言1.1编写目的本概要说明书按照《需求规格说明书》的功能需求，设计本系统的软件结构，供后续软件过程(详细设计等)做依据，预期读者为后续软件过程的设计、开发人员。 2. 总体设计2.1需求规定2.1.2输入输出要求参照需求文档的说明 2.2运行环境本系统必须运行在局域网或互联网中 2.2.1支持架构客户端 服务器端 后台数据库 2.3基本设计概念和处理流程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/%E5%B0%81%E9%9D%A2/13.jpg">
<meta property="article:published_time" content="2025-01-03T14:25:25.650Z">
<meta property="article:modified_time" content="2025-01-03T18:00:23.158Z">
<meta property="article:author" content="阿泽">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="区块链">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="solidity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/%E5%B0%81%E9%9D%A2/13.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2025/01/03/%E5%A5%97%E9%A2%98%E4%B8%80/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '区块链 套题一',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="//at.alicdn.com/t/font_2264842_b004iy0kk2b.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/readPercent.css"><div id="myscoll"></div><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/home_bg.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/封面/13.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Azer</span></a><a class="nav-page-title" href="/"><span class="site-name">区块链 套题一</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">区块链 套题一</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-03T14:25:25.650Z" title="发表于 2025-01-03 22:25:25">2025-01-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-03T18:00:23.158Z" title="更新于 2025-01-04 02:00:23">2025-01-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">21.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>100分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/01/03/%E5%A5%97%E9%A2%98%E4%B8%80/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;已經過了&quot;,&quot;messageNext&quot;:&quot;天自上次更新，文章內容可能已過時。&quot;,&quot;postUpdate&quot;:&quot;2025-01-04 02:00:23&quot;}" hidden></div><h1 id="套题一"><a href="#套题一" class="headerlink" title="套题一"></a>套题一</h1><h1 id="区块链食品溯源系统概要设计说明书"><a href="#区块链食品溯源系统概要设计说明书" class="headerlink" title="区块链食品溯源系统概要设计说明书"></a>区块链食品溯源系统概要设计说明书</h1><h2 id="1．引言"><a href="#1．引言" class="headerlink" title="1．引言"></a>1．引言</h2><h3 id="1-1编写目的"><a href="#1-1编写目的" class="headerlink" title="1.1编写目的"></a>1.1编写目的</h3><p>本概要说明书按照《需求规格说明书》的功能需求，设计本系统的软件结构，供后续软件过程(详细设计等)做依据，预期读者为后续软件过程的设计、开发人员。</p>
<h2 id="2-总体设计"><a href="#2-总体设计" class="headerlink" title="2. 总体设计"></a>2. 总体设计</h2><h3 id="2-1需求规定"><a href="#2-1需求规定" class="headerlink" title="2.1需求规定"></a>2.1需求规定</h3><h4 id="2-1-2输入输出要求"><a href="#2-1-2输入输出要求" class="headerlink" title="2.1.2输入输出要求"></a>2.1.2输入输出要求</h4><p>参照需求文档的说明</p>
<h3 id="2-2运行环境"><a href="#2-2运行环境" class="headerlink" title="2.2运行环境"></a>2.2运行环境</h3><p>本系统必须运行在局域网或互联网中</p>
<h4 id="2-2-1支持架构"><a href="#2-2-1支持架构" class="headerlink" title="2.2.1支持架构"></a>2.2.1支持架构</h4><p>客户端</p>
<p>服务器端</p>
<p>后台数据库</p>
<h3 id="2-3基本设计概念和处理流程"><a href="#2-3基本设计概念和处理流程" class="headerlink" title="2.3基本设计概念和处理流程"></a>2.3基本设计概念和处理流程</h3><p>本系统软件部分可划分为浏览器页面、服务器端。用户通过浏览器访问相关页面，输入业务请求，发送到服务器端，调用业务系统接口处理后，把业务处理应答发送给客户端用户。</p>
<p>系统框架图如下</p>
<p>&#x2F;&#x2F;将任务1-1第1小题结果复制至此；</p>
<p> <img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101100539636.png" alt="image-20241101100539636"></p>
<h4 id="2-3-1-登录业务功能模块"><a href="#2-3-1-登录业务功能模块" class="headerlink" title="2.3.1 登录业务功能模块"></a>2.3.1 登录业务功能模块</h4><p>&#x2F;&#x2F;在这里补充</p>
<h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><ul>
<li><p>用户名</p>
</li>
<li><p>密码</p>
</li>
<li><p>登录按钮</p>
</li>
</ul>
<p>该登录业务功能模块包含以下要素：</p>
<ul>
<li><p>用户名：用户在该字段输入登录账号的用户名。</p>
</li>
<li><p>密码：用户在该字段输入登录账号的密码。</p>
</li>
<li><p>登录按钮：用户点击该按钮以提交登录请求。</p>
</li>
</ul>
<p>用户在浏览器页面中输入用户名和密码，并点击登录按钮后，这些信息将被发送到服务器端进行处理。服务器端会验证用户名和密码的正确性，并根据验证结果生成登录的应答。应答会包含登录成功或失败的信息，以及可能的附加数据，如用户信息或访问令牌等。</p>
<p>登录业务功能模块是系统中的重要模块，用于验证用户身份并授权其访问系统的其他功能和数据。它通常与用户管理、权限控制和会话管理等模块密切相关，确保系统的安全性和用户的身份验证。</p>
<h4 id="2-3-2-食品订单溯源功能模块"><a href="#2-3-2-食品订单溯源功能模块" class="headerlink" title="2.3.2 食品订单溯源功能模块"></a>2.3.2 食品订单溯源功能模块</h4><p>&#x2F;&#x2F;在这里补充</p>
<h5 id="食品订单溯源"><a href="#食品订单溯源" class="headerlink" title="食品订单溯源"></a>食品订单溯源</h5><p>该食品订单溯源功能模块包含以下要素：</p>
<ul>
<li><p>订单列表：展示用户的食品订单列表。</p>
</li>
<li><p>订单详情：展示具体订单的详细信息。</p>
</li>
<li><ul>
<li>订单编号：显示订单的唯一标识符。</li>
</ul>
</li>
<li><ul>
<li>下单时间：显示订单的下单时间。</li>
</ul>
</li>
<li><ul>
<li>食品列表：展示订单中包含的食品列表。</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>食品名称：显示食品的名称。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>食品数量：显示食品的数量。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>食品生产信息：展示食品的生产相关信息。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>生产日期：显示食品的生产日期。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>生产批次：显示食品的生产批次号。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>生产厂商：显示食品的生产厂商。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>生产地点：显示食品的生产地点。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>生产工艺：显示食品的生产工艺。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>食品流转信息：展示食品的流转过程信息。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>流转节点：显示食品流转的节点，如生产、仓储、物流等。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>流转时间：显示食品流转的时间。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>流转地点：显示食品流转的地点。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>流转状态：显示食品流转的状态，如在途、已签收等。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-4结构"><a href="#2-4结构" class="headerlink" title="2.4结构"></a>2.4结构</h3><h4 id="2-4-1-总体框图"><a href="#2-4-1-总体框图" class="headerlink" title="2.4.1 总体框图"></a>2.4.1 总体框图</h4><p>&#x2F;&#x2F;将任务1-1第2小题结果复制至此；</p>
<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps25.jpg" alt="img"> </p>
<h4 id="2-4-2-功能模块接口及说明"><a href="#2-4-2-功能模块接口及说明" class="headerlink" title="2.4.2 功能模块接口及说明"></a>2.4.2 功能模块接口及说明</h4><p>由于在后续设计中，对各功能模块的每个子功能都要详细的加以详细的描述，因此恰当的标识符将有助于文档的阅读和代码的编写。</p>
<p>命名规则：</p>
<p>1．数据库表名命名规则</p>
<p>由前缀和实际名字组成。前缀：使用小写字母tb，表示表。实际名字采用其英文缩写，且首字母要大写。</p>
<p>2．数据库表中字段命名规则</p>
<p>根据其中文名称直接翻译成英文，其首字母要大写；若为多个词的组合，则每个词的首字母都要大写。</p>
<p>3．模块标识符命名规则</p>
<p>应本着便于理解和尽量简洁的原则来命名标识符。在本系统中，各模块均以每个词英文的前几个字母来命名，模块下的子功能也以其英文简写来命名,且每个词首字母均为大写。</p>
<p>4．程序中变量命名规则</p>
<p>每个变量都要以其所在的模块的为前缀，该前缀可以是该模块标识符中大写字母的组合，前缀后面加下划线“_”。后面的字母小写，并且不能包含JAVA的关键字，如果变量是两个单词组成，第二个单词的首字母要大写。</p>
<p>5．程序中函数命名规则</p>
<p>每个函数名都要以其所在的模块的为前缀，该前缀可以是该模块标识符中大写字母的组合，前缀后面加下划线“_”。首字母小写，多个单词的函数名，从第二个单词开始单词首字母大写。</p>
<p>&#x2F;&#x2F;补充填写请求参数、相应参数内容</p>
<h5 id="2-4-2-1-用户信息查询"><a href="#2-4-2-1-用户信息查询" class="headerlink" title="2.4.2.1 用户信息查询"></a>2.4.2.1 用户信息查询</h5><p>1.功能描述</p>
<table>
<thead>
<tr>
<th>标识符</th>
<th>userInfo</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>通过指定用户地址获取详细信息</td>
</tr>
</tbody></table>
<p> 2.接口功能</p>
<table>
<thead>
<tr>
<th>请求路由</th>
<th>&#x2F;userInfo</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>POST</td>
<td></td>
</tr>
<tr>
<td>请求参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>Username</td>
<td>String</td>
<td>用户名</td>
</tr>
<tr>
<td>User address</td>
<td>String</td>
<td>用户地址</td>
</tr>
<tr>
<td>响应参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>Username</td>
<td>String</td>
<td>用户名</td>
</tr>
<tr>
<td>Email</td>
<td>String</td>
<td>邮箱</td>
</tr>
<tr>
<td>Balance</td>
<td>Float</td>
<td>账户余额</td>
</tr>
<tr>
<td>Createdat</td>
<td>String</td>
<td>账户创建时间</td>
</tr>
</tbody></table>
<h5 id="2-4-2-2-生产订单创建"><a href="#2-4-2-2-生产订单创建" class="headerlink" title="2.4.2.2 生产订单创建"></a>2.4.2.2 生产订单创建</h5><ol>
<li>功能描述</li>
</ol>
<table>
<thead>
<tr>
<th>标识符</th>
<th>produce</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>生产商创建食品溯源中生产订单相关信息</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口功能</li>
</ol>
<table>
<thead>
<tr>
<th>请求路由</th>
<th>&#x2F;produce</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>POST</td>
<td></td>
</tr>
<tr>
<td>请求参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>ProductlID</td>
<td>string</td>
<td>产品标识符</td>
</tr>
<tr>
<td>Quantity</td>
<td>int</td>
<td>订单数量</td>
</tr>
<tr>
<td>ProductionDate</td>
<td>string</td>
<td>生产日期</td>
</tr>
<tr>
<td>BatchNumber</td>
<td>String</td>
<td>批次号</td>
</tr>
<tr>
<td>响应参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>OrderID</td>
<td>string</td>
<td>创建的生产订单标识符</td>
</tr>
<tr>
<td>Message</td>
<td>string</td>
<td>操作结果</td>
</tr>
</tbody></table>
<h5 id="2-4-2-3-分销订单创建"><a href="#2-4-2-3-分销订单创建" class="headerlink" title="2.4.2.3 分销订单创建"></a>2.4.2.3 分销订单创建</h5><ol>
<li>功能描述</li>
</ol>
<table>
<thead>
<tr>
<th>标识符</th>
<th>ditribute</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>分销商创建食品溯源中分销订单相关信息</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口功能</li>
</ol>
<table>
<thead>
<tr>
<th>请求路由</th>
<th>distribute</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>POST</td>
<td></td>
</tr>
<tr>
<td>请求参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>ProductlID</td>
<td>string</td>
<td>产品标识符</td>
</tr>
<tr>
<td>Quantity</td>
<td>int</td>
<td>订单数量</td>
</tr>
<tr>
<td>DistributionDate</td>
<td>String</td>
<td>配送时间</td>
</tr>
<tr>
<td>Recipient</td>
<td>String</td>
<td>收件人</td>
</tr>
<tr>
<td>Deliveryaddress</td>
<td>String</td>
<td>收货地址</td>
</tr>
<tr>
<td>响应参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>orderID</td>
<td>String</td>
<td>创建分销订单标识符</td>
</tr>
<tr>
<td>Message</td>
<td>String</td>
<td>操作结果消息</td>
</tr>
</tbody></table>
<h5 id="2-4-2-4-销售订单创建"><a href="#2-4-2-4-销售订单创建" class="headerlink" title="2.4.2.4 销售订单创建"></a>2.4.2.4 销售订单创建</h5><ol>
<li>功能描述</li>
</ol>
<table>
<thead>
<tr>
<th>标识符</th>
<th>retail</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>分销商创建食品溯源中分销订单相关信息。</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口功能</li>
</ol>
<table>
<thead>
<tr>
<th>请求路由</th>
<th>retail</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>POST</td>
<td></td>
</tr>
<tr>
<td>请求参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>ProductID</td>
<td>String</td>
<td>产品标识符</td>
</tr>
<tr>
<td>Quantity</td>
<td>Int</td>
<td>订单数量</td>
</tr>
<tr>
<td>Customername</td>
<td>String</td>
<td>客户姓名</td>
</tr>
<tr>
<td>shippingAdderss</td>
<td>String</td>
<td>收货地址</td>
</tr>
<tr>
<td>响应参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>orderID</td>
<td>String</td>
<td>创建订单标识符</td>
</tr>
<tr>
<td>Message</td>
<td>String</td>
<td>操作结果消息</td>
</tr>
</tbody></table>
<h5 id="2-4-2-5-食品信息追溯查询"><a href="#2-4-2-5-食品信息追溯查询" class="headerlink" title="2.4.2.5 食品信息追溯查询"></a>2.4.2.5 食品信息追溯查询</h5><ol>
<li>功能描述</li>
</ol>
<table>
<thead>
<tr>
<th>标识符</th>
<th>trace</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>通过指定订单号追溯食品信息</td>
</tr>
</tbody></table>
<ol start="2">
<li>接口功能</li>
</ol>
<table>
<thead>
<tr>
<th>请求路由</th>
<th>&#x2F;trace</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>POST</td>
<td></td>
</tr>
<tr>
<td>请求参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>orderID</td>
<td>String</td>
<td>订单号</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>响应参数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>参数名</td>
<td>类型</td>
<td>说明</td>
</tr>
<tr>
<td>productID</td>
<td>String</td>
<td>产品标识符</td>
</tr>
<tr>
<td>ProducetionDate</td>
<td>String</td>
<td>生产日期</td>
</tr>
<tr>
<td>bacthNumber</td>
<td>String</td>
<td>食品状态</td>
</tr>
<tr>
<td>Tarcelnfo</td>
<td>Array</td>
<td>追溯信息数组</td>
</tr>
</tbody></table>
<h2 id="3．系统数据库设计"><a href="#3．系统数据库设计" class="headerlink" title="3．系统数据库设计"></a>3．系统数据库设计</h2><p>通过中心化的方式存储系统中用户信息，包括用户名(username)、密码(password)、角色(role)、地址(address)内容。</p>
<h3 id="3-1-User表（user）"><a href="#3-1-User表（user）" class="headerlink" title="3.1 User表（user）"></a>3.1 User表（user）</h3><table>
<thead>
<tr>
<th>字段名称</th>
<th>字段类型</th>
<th>含义</th>
<th>是否可为NULL</th>
<th>是否Primary Key</th>
</tr>
</thead>
<tbody><tr>
<td>username</td>
<td>varchar</td>
<td>用户名</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>password</td>
<td>varchar</td>
<td>密码</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>role</td>
<td>Integer</td>
<td>用户角色</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>address</td>
<td>varchar</td>
<td>区块链地址</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="4．系统出错处理设计"><a href="#4．系统出错处理设计" class="headerlink" title="4．系统出错处理设计"></a>4．系统出错处理设计</h2><h3 id="4-1出错信息"><a href="#4-1出错信息" class="headerlink" title="4.1出错信息"></a>4.1出错信息</h3><p>服务器端可能有Java的异常产生，可用Java中的异常处理方法try…catch处理,并记录日志，以备事后分析查找原因。</p>
<h3 id="4-2补救措施"><a href="#4-2补救措施" class="headerlink" title="4.2补救措施"></a>4.2补救措施</h3><p>采用双服务器热备份的方法，一旦服务器崩溃，立即切换到另一台服务器运行。</p>
<h3 id="4-3系统维护设计"><a href="#4-3系统维护设计" class="headerlink" title="4.3系统维护设计"></a>4.3系统维护设计</h3><p>保留本系统的一系列文档，加适当注释，以备维护者维护。每次修改&#x2F;维护，都做记录。</p>
<h1 id="模块一"><a href="#模块一" class="headerlink" title="模块一"></a>模块一</h1><p><strong>*模块一：区块链产品方案设计及系统运维（35分）*</strong></p>
<p>选手完成本模块的任务后，将任务中设计结果、运行代码、运行结果等截图粘贴至客户端桌面【区块链技术应用赛\重命名为工位号\模块一提交结果.docx】中对应的任务序号下。</p>
<h2 id="任务1-1：区块链产品需求分析与方案设计"><a href="#任务1-1：区块链产品需求分析与方案设计" class="headerlink" title="任务1-1：区块链产品需求分析与方案设计"></a>任务1-1：区块链产品需求分析与方案设计</h2><p>本任务需要依据项目背景完成需求分析与方案设计，具体要求如下:</p>
<ol>
<li><p>依据给定区块链食品溯源系统的业务架构图，对考题进行业务分析，尽可能全面的考虑一个业务系统所需要的模块，使用Visio或思维导图工具展现本系统的基本设计概念和处理流程，要求分为区块链食品溯源业务平台和支撑平台两个部分；</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101100548135.png" alt="image-20241101100548135"></p>
</li>
<li><p>根据食品溯源系统设计，在系统中分别包括用户管理以及订单追溯功能，在订单追溯中需要包括生产商、分销商、经销商订单的追溯管理功能。根据描述，设计区块链系统的总体功能概览图；</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101095818119.png" alt="image-20241101095818119"></p>
</li>
<li><p>整合上述设计内容，完善“区块链食品溯源系统概要设计说明书.doc”，具体工作内容如下：</p>
</li>
</ol>
<p>（1）将设计内容根据说明书中模块需求进行补充，并完善概要设计说明书中的“需求概要”；</p>
<p>（2）完善说明书中接口说明部分内容。</p>
<p> 完成后提交“区块链食品溯源系统概要设计说明书.doc”文档至【区块链技术应用赛\重命名为工位号】下。</p>
<h2 id="任务1-2：区块链系统部署与运维"><a href="#任务1-2：区块链系统部署与运维" class="headerlink" title="任务1-2：区块链系统部署与运维"></a>任务1-2：区块链系统部署与运维</h2><p>围绕食品安全溯源区块链平台部署与运维需求，进行项目相关系统、节点以及管理工具的部署工作。通过监控工具完成对网络、节点服务的监控。最终根据业务需求规范，完成系统日志、网络参数、节点服务等系统结构的维护，具体要求如下：</p>
<ol>
<li><p>根据参数与端口设置要求，部署区块链系统并验证；</p>
</li>
<li><p>根据参数与端口设置要求，部署区块链网络管理平台并验证；</p>
</li>
<li><p>基于区块链系统相关管理平台，按照任务指南实施系统运维工作并验证；</p>
</li>
<li><p>基于区块链系统相关监管工具，按照任务指南对区块链系统进行监管。</p>
</li>
</ol>
<h3 id="子任务1-2-1：-搭建区块链系统并验证"><a href="#子任务1-2-1：-搭建区块链系统并验证" class="headerlink" title="子任务1-2-1： 搭建区块链系统并验证"></a>子任务1-2-1： 搭建区块链系统并验证</h3><p>基于给定服务器环境以及软件（地址“&#x2F;root&#x2F;tools”），搭建一条4节点的区块链系统并验证，具体工作内容如下：</p>
<h4 id="（1）-采用默认配置搭建区块链网络；"><a href="#（1）-采用默认配置搭建区块链网络；" class="headerlink" title="（1） 采用默认配置搭建区块链网络；"></a>（1） 采用默认配置搭建区块链网络；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd /root/tools</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改build_chain.sh脚本文件的权限</span></span><br><span class="line">chmod u+x build_chain.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写一个ipconf文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用于定义区块链网络中的节点配置，包括IP地址、节点数量、机构名称以及节点所属的群组列表</span></span><br><span class="line">cat &gt;&gt; ipconf &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">127.0.0.1:4 agency 1,2,3</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EOF</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搭建区块链网络</span></span><br><span class="line">bash build_chain.sh -f ipconf -p 30300,20200,8545</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101112842699.png" alt="image-20241101112842699"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动所有节点</span></span><br><span class="line">bash nodes/127.0.0.1/start_all.sh</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101112917837.png" alt="image-20241101112917837"></p>
<h4 id="（2）-通过命令验证区块链节点进程运行状况；"><a href="#（2）-通过命令验证区块链节点进程运行状况；" class="headerlink" title="（2） 通过命令验证区块链节点进程运行状况；"></a>（2） 通过命令验证区块链节点进程运行状况；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps ef | grep -v grep | grep fisco-bcos</span><br><span class="line">tail -f nodes/127.0.0.1/node0/log/* | grep &quot;g:1.*++&quot;</span><br><span class="line">tail -f nodes/127.0.0.1/node0/log/* | grep &quot;g:2.*++&quot;</span><br><span class="line">tail -f nodes/127.0.0.1/node0/log/* | grep &quot;g:3.*++&quot;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101113214191.png" alt="image-20241101113214191"></p>
<h4 id="（3）-通过命令验证区块链连接状态和共识状态日志输出。"><a href="#（3）-通过命令验证区块链连接状态和共识状态日志输出。" class="headerlink" title="（3） 通过命令验证区块链连接状态和共识状态日志输出。"></a>（3） 通过命令验证区块链连接状态和共识状态日志输出。</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail -f nodes/127.0.0.1/node0/log/* | grep connected</span><br><span class="line">tail -f nodes/127.0.0.1/node0/log/* | grep ++</span><br><span class="line">cat nodes/127.0.0.1/node0/config.ini | grep channel_listen_port</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101150655429.png" alt="image-20241101150655429"></p>
<h3 id="子任务1-2-2：搭建区块链系统管理平台并验证"><a href="#子任务1-2-2：搭建区块链系统管理平台并验证" class="headerlink" title="子任务1-2-2：搭建区块链系统管理平台并验证"></a>子任务1-2-2：搭建区块链系统管理平台并验证</h3><p>基于给定服务器环境以及软件（地址“&#x2F;root&#x2F;tools”），搭建区块链控制台并开展相关运维工作，具体工作内容如下：</p>
<h4 id="（1）配置控制台，管理相关证书并启动；"><a href="#（1）配置控制台，管理相关证书并启动；" class="headerlink" title="（1）配置控制台，管理相关证书并启动；"></a>（1）配置控制台，管理相关证书并启动；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压文件</span></span><br><span class="line">tar -zxvf console.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝配置文件</span></span><br><span class="line">cp -n console/conf/config-example.toml console/conf/config.toml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝证书</span></span><br><span class="line">cp -r nodes/127.0.0.1/sdk/* console/conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动控制台</span></span><br><span class="line">bash console/start.sh</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101151833162.png" alt="image-20241101151833162"></p>
<h4 id="（2）使用控制台安装HelloWorld智能合约；"><a href="#（2）使用控制台安装HelloWorld智能合约；" class="headerlink" title="（2）使用控制台安装HelloWorld智能合约；"></a>（2）使用控制台安装HelloWorld智能合约；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[group:1]&gt; deploy HelloWorld</span><br><span class="line">[group:1]&gt; exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换群组2部署HelloWorld</span></span><br><span class="line">bash console/start.sh 2</span><br><span class="line">[group:2]&gt; deploy HelloWorld</span><br><span class="line">[group:2]&gt; exit </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换群组3部署HelloWorld</span></span><br><span class="line">bash console/start.sh 3</span><br><span class="line">[group:3]&gt; deploy HelloWorld</span><br><span class="line">[group:3]&gt; exit </span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101152826799.png" alt="image-20241101152826799"></p>
<h4 id="3-使用控制台将node2节点添加为group2的观察者节点"><a href="#3-使用控制台将node2节点添加为group2的观察者节点" class="headerlink" title="(3)   使用控制台将node2节点添加为group2的观察者节点"></a>(3)   使用控制台将node2节点添加为group2的观察者节点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取node2的节点<span class="built_in">id</span></span></span><br><span class="line">cat nodes/127.0.0.1/node2/conf/node.nodeid</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用group2进入控制台</span></span><br><span class="line">bash console/start.sh 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将节点添加为观察者节点</span></span><br><span class="line">[group:2]&gt; addObserver &quot;node2节点的id&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有观察节点</span></span><br><span class="line">[group:2]&gt; getObserverLists</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101153846580.png" alt="image-20241101153846580"></p>
<h4 id="（4）-使用控制台完成HelloWorld智能合约的set与get操作；"><a href="#（4）-使用控制台完成HelloWorld智能合约的set与get操作；" class="headerlink" title="（4） 使用控制台完成HelloWorld智能合约的set与get操作；"></a>（4） 使用控制台完成HelloWorld智能合约的set与get操作；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[group:1]&gt; call HelloWorld &quot;contract Address&quot; set &quot;FISCO_BCOS&quot;</span><br><span class="line">[group:1]&gt; call HelloWorld &quot;contract Address&quot; get</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101152229169.png" alt="image-20241101152229169"></p>
<h4 id="（5）-使用控制台查看区块链中区块高度；"><a href="#（5）-使用控制台查看区块链中区块高度；" class="headerlink" title="（5） 使用控制台查看区块链中区块高度；"></a>（5） 使用控制台查看区块链中区块高度；</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[group:1]&gt; getBlockNumber</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101153019023.png" alt="image-20241101153019023"></p>
<p>评分附加题： 使用脚本创建三个用户，Account1,Account2,Account3, 将Account1,Account2设置为委员账户，将Account3 设置为运维账号部署HelloWorld合约</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入到console目录下</span></span><br><span class="line">cd console</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建账户Account1</span></span><br><span class="line">bash get_account.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建账户Account2</span></span><br><span class="line">bash get_account.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建账户Account3</span></span><br><span class="line">bash get_account.sh</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101154720908.png" alt="image-20241101154720908"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用账户的私钥进入控制台</span></span><br><span class="line">bash console/start.sh 1 -pem accounts/Account1.pem</span><br><span class="line">Account1:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将Account1账户设为委员账户</span></span><br><span class="line">[group:1]&gt; grantCommitteeMember Account1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有的委员账户</span></span><br><span class="line">[group:1]&gt; listCommitteeMembers</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101155447121.png" alt="image-20241101155447121"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用账户的私钥进入控制台</span></span><br><span class="line">bash console/start.sh 1 -pem accounts/Account2.pem</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将Account2账户设为委员账户 因为Account1是委员长，所以Account2要想成为委员就需要获得委员长的同意</span></span><br><span class="line">Account2:</span><br><span class="line">[group:1]&gt; grantCommitteeMember Account2</span><br><span class="line"></span><br><span class="line">Account1:</span><br><span class="line">[group:1]&gt; grantCommitteeMember Account1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有的委员账户</span></span><br><span class="line">[group:1]&gt; listCommitteeMembers</span><br></pre></td></tr></table></figure>

<p>1 是 Account1 进入的控制台，2 同理</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101160544128.png" alt="image-20241101160544128"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将Account3设置为运维账户，并部署HelloWorld合约</span></span><br><span class="line">Account1:</span><br><span class="line">[group:1]&gt; grantOperator Account3</span><br><span class="line"></span><br><span class="line">Account2:</span><br><span class="line">[group:1]&gt; grantOperator Account3</span><br><span class="line">[group:1]&gt; listOperators</span><br><span class="line"></span><br><span class="line">bash console/start.sh 1 -pem accounts/Account3.pem</span><br><span class="line"></span><br><span class="line">Account3:</span><br><span class="line">[group:1]&gt; deploy HelloWorld</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101161843080.png" alt="image-20241101161843080"></p>
<h3 id="子任务1-2-3：区块链节点运维"><a href="#子任务1-2-3：区块链节点运维" class="headerlink" title="子任务1-2-3：区块链节点运维"></a>子任务1-2-3：区块链节点运维</h3><p>基于已完成的区块链系统与管理平台搭建工作，开展区块链节点的加入与退出运维工作，具体内容如下：</p>
<h4 id="（1）获取指定区块链节点输出等级为警告级，并设置日志存储阈值位100MB并验证；"><a href="#（1）获取指定区块链节点输出等级为警告级，并设置日志存储阈值位100MB并验证；" class="headerlink" title="（1）获取指定区块链节点输出等级为警告级，并设置日志存储阈值位100MB并验证；"></a>（1）获取指定区块链节点输出等级为警告级，并设置日志存储阈值位100MB并验证；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用sed命令编辑config.ini</span></span><br><span class="line">sed -i &#x27;s/level=info/level=warning/&#x27; nodes/127.0.0.1/node*/config.ini </span><br><span class="line">sed -i &#x27;s/max_log_file_size=200/max_log_file_size=100/&#x27; nodes/127.0.0.1/node*/config.ini</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证一</span></span><br><span class="line">cat node*/config.ini | grep &quot;level&quot;</span><br><span class="line">cat node*/config.ini | grep &quot;max_log_file_size&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证二</span></span><br><span class="line">grep -E &quot;level|max_log_file_size&quot; node*/config.ini</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101163054440.png" alt="image-20241101163054440"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101164248814.png" alt="image-20241101164248814"></p>
<h4 id="（2）通过给定工具（地址-root-tools）完成新节点（node4）配置；"><a href="#（2）通过给定工具（地址-root-tools）完成新节点（node4）配置；" class="headerlink" title="（2）通过给定工具（地址&#x2F;root&#x2F;tools）完成新节点（node4）配置；"></a>（2）通过给定工具（地址&#x2F;root&#x2F;tools）完成新节点（node4）配置；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建节点</span></span><br><span class="line">bash gen_node_cert -c nodes/cert/agency -o nodes/127.0.0.1/node4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝node0配置文件</span></span><br><span class="line">cp -n node0/config.ini node0/st* node4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置文件</span></span><br><span class="line">vim node4/config.ini</span><br></pre></td></tr></table></figure>

<p>新建节点</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101172906239.png" alt="image-20241101172906239"></p>
<p>修改文件</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101171908704.png" alt="image-20241101171908704"></p>
<h4 id="（3）启动新节点加入区块链系统并验证。"><a href="#（3）启动新节点加入区块链系统并验证。" class="headerlink" title="（3）启动新节点加入区块链系统并验证。"></a>（3）启动新节点加入区块链系统并验证。</h4><p>1.获取node4的nodeid</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat nodes/127.0.0.1/node4/conf/node.nodeid</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101173033369.png" alt="image-20241101173033369"></p>
<p>2.使用addObserver将node4作为观察节点加入群组1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加观察节点</span></span><br><span class="line">addObserver 节点id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证是否成功</span></span><br><span class="line">getObserverList</span><br></pre></td></tr></table></figure>



<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps20.jpg" alt="img"> </p>
<p>3.使用addSealer将node4作为共识节点加入群组1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加共识节点</span></span><br><span class="line">addSealer 节点id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证节点是否加入</span></span><br><span class="line">getSealerList</span><br></pre></td></tr></table></figure>



<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps21.jpg" alt="img"> </p>
<p>检查新节点连接情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f nodes/127.0.0.1/node4/log/* | grep P2P</span><br></pre></td></tr></table></figure>



<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps22.jpg" alt="img"> </p>
<h3 id="子任务1-2-4：区块链网络运维"><a href="#子任务1-2-4：区块链网络运维" class="headerlink" title="子任务1-2-4：区块链网络运维"></a>子任务1-2-4：区块链网络运维</h3><p>根据任务描述要求，完成网络配置与管理运维操作，具体内容如下：</p>
<h4 id="（1）设置区块链系统黑名单，将node3设为黑名单禁止连接，并验证；"><a href="#（1）设置区块链系统黑名单，将node3设为黑名单禁止连接，并验证；" class="headerlink" title="（1）设置区块链系统黑名单，将node3设为黑名单禁止连接，并验证；"></a>（1）设置区块链系统黑名单，将node3设为黑名单禁止连接，并验证；</h4> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将node3节点加入黑名单</span></span><br><span class="line">sed -i &#x27;/\[certificate_blacklist\]/,/^\s*$ /s/;crl.0=/;crl.0=&quot;node3节点id&quot;/&#x27; nodes/127.0.0.1/node*/config.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新启动node3节点</span></span><br><span class="line">bash nodes/127.0.0.1/node3/stop.sh &amp;&amp; bash nodes/127.0.0.1/node3/start.sh </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">cat nodes/127.0.0.1/node*/config.ini | grep &quot;;crls=*&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证节点是否连接</span></span><br><span class="line">tail -f nodes/127.0.0.1/node3/log/* | grep connected</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241101202511299.png" alt="image-20241101202511299"></p>
<h4 id="（2）设置系统中区块打包最大交易数量设为2000；"><a href="#（2）设置系统中区块打包最大交易数量设为2000；" class="headerlink" title="（2）设置系统中区块打包最大交易数量设为2000；"></a>（2）设置系统中区块打包最大交易数量设为2000；</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSystemConfigByKey tx_count_limit 2000</span><br></pre></td></tr></table></figure>



<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps23.jpg" alt="img"> </p>
<h4 id="（3）验证区块最大打包交易数量情况"><a href="#（3）验证区块最大打包交易数量情况" class="headerlink" title="（3）验证区块最大打包交易数量情况"></a>（3）验证区块最大打包交易数量情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getSystemConfigByKey tx_count_limit 2000</span><br></pre></td></tr></table></figure>



<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml95508\wps24.jpg" alt="img">承担</p>
<h2 id="任务1-3：区块链系统测试"><a href="#任务1-3：区块链系统测试" class="headerlink" title="任务1-3：区块链系统测试"></a>任务1-3：区块链系统测试</h2><p>设计对区块链系统的测试流程；结合实际业务需求，调用部署的智能合约进行系统测试、性能测试等；根据业务需求，分析并且修复给定智能合约中的安全漏洞。利用模拟业务和测试工具来完成对区块链系统服务数据的测试。</p>
<h3 id="1-使用命令启动区块链系统可视化一体平台并验证启动情况；"><a href="#1-使用命令启动区块链系统可视化一体平台并验证启动情况；" class="headerlink" title="1.使用命令启动区块链系统可视化一体平台并验证启动情况；"></a>1.使用命令启动区块链系统可视化一体平台并验证启动情况；</h3><h3 id="2-通过可视化平台生成包括生产商-Producer-、经销商-distributor-、零售商-retailer-账户，并将账户以p12加密形式导出后倒入指定前置可视化平台，验证地址一致性；"><a href="#2-通过可视化平台生成包括生产商-Producer-、经销商-distributor-、零售商-retailer-账户，并将账户以p12加密形式导出后倒入指定前置可视化平台，验证地址一致性；" class="headerlink" title="2.通过可视化平台生成包括生产商(Producer)、经销商(distributor)、零售商(retailer)账户，并将账户以p12加密形式导出后倒入指定前置可视化平台，验证地址一致性；"></a>2.通过可视化平台生成包括生产商(Producer)、经销商(distributor)、零售商(retailer)账户，并将账户以p12加密形式导出后倒入指定前置可视化平台，验证地址一致性；</h3><h3 id="3-使用Postman对上述功能接口进行验证，并将验证结果截图提交工程文档。对食品溯源系统服务端“添加食品”-produce-功能接口进行验证。"><a href="#3-使用Postman对上述功能接口进行验证，并将验证结果截图提交工程文档。对食品溯源系统服务端“添加食品”-produce-功能接口进行验证。" class="headerlink" title="3.使用Postman对上述功能接口进行验证，并将验证结果截图提交工程文档。对食品溯源系统服务端“添加食品”(&#x2F;produce)功能接口进行验证。"></a>3.使用Postman对上述功能接口进行验证，并将验证结果截图提交工程文档。对食品溯源系统服务端“添加食品”(&#x2F;produce)功能接口进行验证。</h3><table>
<thead>
<tr>
<th>请求路由:</th>
<th>&#x2F;produce</th>
</tr>
</thead>
<tbody><tr>
<td>请求方法：</td>
<td>POST</td>
</tr>
<tr>
<td>输入项说明：</td>
<td>输入项 类型 说明 traceNumberString 追踪编号foodNameString食品名称traceNameString存证人地址 qualityInteger食品质量</td>
</tr>
<tr>
<td>输出项说明：</td>
<td>输出项 类型 说明retInteger返回值msgString返回消息，”Success”表示操作成功</td>
</tr>
</tbody></table>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031200320173.png" alt="image-20241031200320173"></p>
<h3 id="4-参照工程项目（地址：“-root-projects”）使用Caliper测试工具对食品安全溯源系统智能合约生成新食品-newFood-功能进行压力测试。具体要求如下："><a href="#4-参照工程项目（地址：“-root-projects”）使用Caliper测试工具对食品安全溯源系统智能合约生成新食品-newFood-功能进行压力测试。具体要求如下：" class="headerlink" title="4.参照工程项目（地址：“&#x2F;root&#x2F;projects”）使用Caliper测试工具对食品安全溯源系统智能合约生成新食品(newFood)功能进行压力测试。具体要求如下："></a>4.参照工程项目（地址：“&#x2F;root&#x2F;projects”）使用Caliper测试工具对食品安全溯源系统智能合约生成新食品(newFood)功能进行压力测试。具体要求如下：</h3><h4 id="（1）-提供核心测试代码；"><a href="#（1）-提供核心测试代码；" class="headerlink" title="（1） 提供核心测试代码；"></a>（1） 提供核心测试代码；</h4><h4 id="（2）-设置txNumber-10，tps-1，所有测试通过率为100"><a href="#（2）-设置txNumber-10，tps-1，所有测试通过率为100" class="headerlink" title="（2） 设置txNumber&#x3D;10，tps&#x3D;1，所有测试通过率为100%"></a>（2） 设置txNumber&#x3D;10，tps&#x3D;1，所有测试通过率为100%</h4><h3 id="5-智能合约安全漏洞测试。"><a href="#5-智能合约安全漏洞测试。" class="headerlink" title="5.智能合约安全漏洞测试。"></a>5.智能合约安全漏洞测试。</h3><p>有如下问题智能合约：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.8.3;</span><br><span class="line"></span><br><span class="line">contract EtherStore &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">  function deposit() public payable &#123;</span><br><span class="line">​    balances[msg.sender] += msg.value;</span><br><span class="line">​    emit Balance(balances[msg.sender]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() public &#123;</span><br><span class="line">​    uint bal = balances[msg.sender];</span><br><span class="line">​    require(bal &gt; 0);</span><br><span class="line">​    (bool sent, ) = msg.sender.call&#123;value: bal&#125;(&quot;&quot;);</span><br><span class="line">​    require(sent, &quot;Failed to send Ether&quot;);</span><br><span class="line">​    balances[msg.sender] = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // Helper function to check the balance of this contract</span><br><span class="line"></span><br><span class="line">  function getBalance() public view returns (uint) &#123;</span><br><span class="line">​    return address(this).balance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">  EtherStore public etherStore;</span><br><span class="line"></span><br><span class="line">  constructor(address _etherStoreAddress) &#123;</span><br><span class="line">​    etherStore = EtherStore(_etherStoreAddress);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // Fallback is called when EtherStore sends Ether to this contract.</span><br><span class="line"></span><br><span class="line">  fallback() external payable &#123;</span><br><span class="line">​    if (address(etherStore).balance &gt;= 1) &#123;</span><br><span class="line">​      etherStore.withdraw();</span><br><span class="line">​    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack() external payable &#123;</span><br><span class="line">​    require(msg.value &gt;= 1);</span><br><span class="line">​    etherStore.deposit&#123;value: 1&#125;();</span><br><span class="line">​    etherStore.withdraw();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Helper function to check the balance of this contract</span><br><span class="line">  function getBalance() public view returns (uint) &#123;</span><br><span class="line">​    return address(this).balance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="（1）-分析智能合约中存在问题，并说明危害；"><a href="#（1）-分析智能合约中存在问题，并说明危害；" class="headerlink" title="（1） 分析智能合约中存在问题，并说明危害；"></a>（1） 分析智能合约中存在问题，并说明危害；</h5><p>智能合约中存在以下问题：</p>
<p>· 在fallback函数中，如果EtherStore合约的余额大于等于1个以太币，攻击合约会调用EtherStore的withdraw函数来提取以太币。</p>
<p>· 在attack函数中，攻击合约会向EtherStore合约存入1个以太币，并立即调用EtherStore的withdraw函数来提取以太币。</p>
<p>这些问题的危害在于：</p>
<p>· 攻击者可以通过重复调用fallback函数来不断提取EtherStore合约中的以太币，导致合约失去大量资金。</p>
<p>· 攻击者可以通过调用attack函数来向EtherStore合约存入1个以太币，并立即提取，以此不断消耗EtherStore合约的以太币。</p>
<p>智能合约中存在以下问题：</p>
<ol>
<li><p>在fallback函数中，如果EtherStore合约的余额大于等于1个以太币，攻击合约会调用EtherStore的withdraw函数来提取以太币</p>
</li>
<li><p>在attack函数中，攻击合约会向EtherStore合约存入1个以太币并立即调用EhterStore的withdraw函数来提取以太币。</p>
</li>
</ol>
<p>这些问题的危害在于：</p>
<ol>
<li><p>攻击者可以通过重复调用fallback函数来不断提取EtherStore合约中的以太币，导致合约失去大量资金</p>
</li>
<li><p>攻击者可以通过调用attack函数来向EhterStore合约存入1个以太币，并立即提取，以此不断消耗EtherStore合约的以太币</p>
</li>
</ol>
<h4 id="（2）-根据测试工具中的代码文件，编写测试用例，复现智能合约中存在的漏洞；"><a href="#（2）-根据测试工具中的代码文件，编写测试用例，复现智能合约中存在的漏洞；" class="headerlink" title="（2） 根据测试工具中的代码文件，编写测试用例，复现智能合约中存在的漏洞；"></a>（2） 根据测试工具中的代码文件，编写测试用例，复现智能合约中存在的漏洞；</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.8.3;</span><br><span class="line"></span><br><span class="line">import &quot;./EtherStore.sol&quot;;</span><br><span class="line">import &quot;./Attack.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract EtherStoreTest &#123;</span><br><span class="line">  EtherStore public etherStore;</span><br><span class="line">  Attack public attack;</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">​    etherStore = new EtherStore();</span><br><span class="line">​    attack = new Attack(address(etherStore));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function testVulnerability() public payable &#123;</span><br><span class="line">​    // Deposit 10 ether to EtherStore</span><br><span class="line">​    etherStore.deposit&#123;value: 10 ether&#125;();</span><br><span class="line">​    // Call the attack function in Attack contract</span><br><span class="line">​    attack.attack&#123;value: 1 ether&#125;();</span><br><span class="line">​    // Check the balance of EtherStore</span><br><span class="line">​    uint etherStoreBalance = etherStore.getBalance();</span><br><span class="line">​    assert(etherStoreBalance == 9 ether);</span><br><span class="line">​    // Check the balance of Attack contract</span><br><span class="line">​    uint attackBalance = attack.getBalance();</span><br><span class="line">​    assert(attackBalance == 0 ether);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在上述测试用例中，我们创了一个EtherStoreTest合约，其中包含了EtherStore合约和Attack合约的实例。通过调用testVulnerability函数，我们首先向EtherStore合约存入10个以太币，然后调用Attack合约的attack函数，向EtherStore合约存入1个以太币并立即提取。最后，我们检查EtherStore合约的余额是否减少了1个以太币，而Attack合约的余额是否保持为0。</p>
<p>请注意，在测试之前需要部署EtherStore、Attack和EtherStoreTest合约，并调用testVulnerability函数来复现漏洞。</p>
<p>在此创建了一个EtherStoreTest合约，其中包含了EtherStore合约和Attack合约的实例。通过调用testVulnerability函数，我们首先向EtherStore合约存入10个以太币，然后调用Attack合约的attack函数，向EtherStore合约存入一个以太币然后立即提取。最后，检查EtherStore合约的余额是否减少了一个以太币，而Attack合约的余额是否还为0。</p>
<p>注：测试之前需要部署EtherStore、Attack和EtherStoreTest合约，并调用testVulnerability函数来复现漏洞</p>
<h4 id="（3）-创建新的智能合约，修复其中问题，说明修复内容并测试。"><a href="#（3）-创建新的智能合约，修复其中问题，说明修复内容并测试。" class="headerlink" title="（3） 创建新的智能合约，修复其中问题，说明修复内容并测试。"></a>（3） 创建新的智能合约，修复其中问题，说明修复内容并测试。</h4><p>完成本任务后将相关命令、代码以及运行结果截图填写至工程文档并提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;=0.8.3;</span><br><span class="line"></span><br><span class="line">contract EtherStoreFixed &#123;</span><br><span class="line">  mapping(address =&gt; uint) public balances;</span><br><span class="line"> </span><br><span class="line">  function deposit() public payable &#123;</span><br><span class="line">​    balances[msg.sender] += msg.value;</span><br><span class="line">​    emit Balance(balances[msg.sender]);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  function withdraw() public &#123;</span><br><span class="line">​    uint bal = balances[msg.sender];</span><br><span class="line">​    require(bal &gt; 0);</span><br><span class="line">​    balances[msg.sender] = 0;</span><br><span class="line">​    (bool sent, ) = msg.sender.call&#123;value: bal&#125;(&quot;&quot;);</span><br><span class="line">​    require(sent, &quot;Failed to send Ether&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // Helper function to check the balance of this contract</span><br><span class="line">  function getBalance() public view returns (uint) &#123;</span><br><span class="line">​    return address(this).balance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>修复内容：<br>修复后的智能合约对原有合约进行了修改，主要修复了两个问题：</p>
<p>· 在withdraw函数中，将余额清零的操作放在发送以太币之前，以防止重入攻击。</p>
<p>· 修改了fallback函数，使其不再自动触发提取以太币的操作。</p>
<h1 id="模块二"><a href="#模块二" class="headerlink" title="模块二"></a>模块二</h1><h2 id="任务2-1：智能合约设计"><a href="#任务2-1：智能合约设计" class="headerlink" title="任务2-1：智能合约设计"></a>任务2-1：智能合约设计</h2><p>根据区块链食品溯源应用需求分析和方案设计文档的描述，编写该区块链产品的智能合约功能需求文档，以及设计该智能合约UML图。具体要求如下：</p>
<h3 id="1-编写区块链食品溯源智能合约功能需求文档"><a href="#1-编写区块链食品溯源智能合约功能需求文档" class="headerlink" title="1.编写区块链食品溯源智能合约功能需求文档"></a>1.编写区块链食品溯源智能合约功能需求文档</h3><p>根据区块链食品溯源产品项目背景和需求分析，编写该区块链食品溯源产品的智能合约功能需求文档。</p>
<h4 id="功能需求"><a href="#功能需求" class="headerlink" title="功能需求"></a>功能需求</h4><ol>
<li><p>食品信息存储</p>
<ul>
<li>合约应该能够接收和存储食品的基本信息，如生产日期，生产批次，供应商等。</li>
<li>食品信息应该以不可篡改的方式存储在区块链上，确保数据的安全性和可信度。</li>
</ul>
</li>
<li><p>食品溯源查询</p>
<ul>
<li>合约应该提供查询接口，允许用户根据食品的id 或者其他关键信息来查询食品的溯源信息。</li>
<li>查询结果应包括食品的生产过程，供应链信息以及相关检验报告等</li>
</ul>
</li>
<li><p>溯源信息更新</p>
<ul>
<li>合约应该允许授权的参与方更新食品的溯源信息，如生产环境的检测数据、物流信息。</li>
<li>更新的信息应被记录在区块链上，并保持数据的一致性和不可篡改性</li>
</ul>
</li>
<li><p>溯源信息验证</p>
<ul>
<li>合约应该提供验证接口，允许用户验证食品的溯源信息的真实性和完整性。</li>
<li>验证过程应基于区块链上存储的数据，确保数据的可靠性和不可篡改性</li>
</ul>
<p>数据结构设计模块：生产商实体信息、分销商实体信息、零售商实体信息、食品实体信息上链</p>
<p>食品溯源模块：生产商生产食品、分销商分销食品、零售商售卖食品信息上链</p>
</li>
</ol>
<h3 id="2-完成区块链食品溯源智能合约的设计图"><a href="#2-完成区块链食品溯源智能合约的设计图" class="headerlink" title="2.完成区块链食品溯源智能合约的设计图"></a>2.完成区块链食品溯源智能合约的设计图</h3><p>设计区块链食品溯源智能合约接口，画出区块链食品溯源智能合约的角色UML用例图，以及画出区块链食品溯源各智能合约关系的时序图。</p>
<h4 id="用例图"><a href="#用例图" class="headerlink" title="用例图"></a>用例图</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103103617450.png" alt="image-20241103103617450"></p>
<h4 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103103553281.png" alt="image-20241103103553281"></p>
<h2 id="任务2-2：智能合约开发"><a href="#任务2-2：智能合约开发" class="headerlink" title="任务2-2：智能合约开发"></a>任务2-2：智能合约开发</h2><p>使用Solidity语言完成智能合约开发、部署和调用，要求如下：</p>
<h3 id="1-食品信息（FoodInfoItem）的接口编码"><a href="#1-食品信息（FoodInfoItem）的接口编码" class="headerlink" title="1.食品信息（FoodInfoItem）的接口编码"></a>1.食品信息（FoodInfoItem）的接口编码</h3><h4 id="（1）编写食品信息实体的接口"><a href="#（1）编写食品信息实体的接口" class="headerlink" title="（1）编写食品信息实体的接口"></a>（1）编写食品信息实体的接口</h4><p>完成可溯源食品信息初始化，实现可追溯的原始生产商食品信息上链功能；</p>
<p>表2-2-1 FoodInfoItem实体说明</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>_currentTraceName</td>
<td>string</td>
<td>当前用户名</td>
</tr>
<tr>
<td>_name</td>
<td>string</td>
<td>食品名称</td>
</tr>
<tr>
<td>_owner</td>
<td>address</td>
<td>合约的创建者</td>
</tr>
<tr>
<td>_quality</td>
<td>uint8</td>
<td>质量</td>
</tr>
<tr>
<td>_status</td>
<td>uint8</td>
<td>状态</td>
</tr>
<tr>
<td>_traceName</td>
<td>string[]</td>
<td>用户名</td>
</tr>
<tr>
<td>_timestamp</td>
<td>uint[]</td>
<td>流转时间戳</td>
</tr>
<tr>
<td>_traceAddress</td>
<td>address[]</td>
<td>用户地址</td>
</tr>
<tr>
<td>_traceQuality</td>
<td>uint8[]</td>
<td>食品质量</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract FoodInfoItem&#123;</span><br><span class="line">  //①保存食品流转过程中各个阶段的时间戳</span><br><span class="line">  //②保存食品流转过程各个阶段的用户名</span><br><span class="line">  //③保存食品流转过程各个阶段的用户地址信息（和用户一一对应）</span><br><span class="line">  //④保存食品流转过程中各个阶段的质量</span><br><span class="line">  //⑤食品名称</span><br><span class="line">  //⑥当前用户名称</span><br><span class="line">  //⑦质量（0=优质 1=合格 2=不合格）</span><br><span class="line">  //⑧状态（0:生产 1:分销 2:出售）</span><br><span class="line">  //⑨初始化owner</span><br></pre></td></tr></table></figure>



<h4 id="答案："><a href="#答案：" class="headerlink" title="答案："></a>答案：</h4> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract FoodInfoItem&#123;</span><br><span class="line">  uint[] _timestamp;</span><br><span class="line">  string[] _traceName;</span><br><span class="line">  address[] _traceAddress;</span><br><span class="line">  uint8[] _traceQuality;</span><br><span class="line">  string _name;</span><br><span class="line">  string _currentTraceName;</span><br><span class="line">  uint8 _quality;</span><br><span class="line">  uint8 _status;</span><br><span class="line">  _owner = &quot;&quot;;</span><br></pre></td></tr></table></figure>





<h4 id="（2）编写分销商食品上链信息接口"><a href="#（2）编写分销商食品上链信息接口" class="headerlink" title="（2）编写分销商食品上链信息接口"></a>（2）编写分销商食品上链信息接口</h4><p>根据食品溯源智能合约地址获取分销商上链食品的信息； </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByDistributor(①, uint8 quality) public returns(bool) &#123;</span><br><span class="line">​    require(_status == 0 , &quot;status must be producing&quot;);</span><br><span class="line">​    //②</span><br><span class="line">​    _timestamp.push(now);</span><br><span class="line">​    _traceName.push(traceName);</span><br><span class="line">​    _currentTraceName = traceName;</span><br><span class="line">​    //③</span><br><span class="line">​    //④</span><br><span class="line">​    _traceQuality.push(_quality);</span><br><span class="line">​    _status = 1;</span><br><span class="line">​    return true;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-1"><a href="#答案：-1" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByDistributor(string traceName, address distributor, uint8 quality) public returns(bool) &#123;</span><br><span class="line">​    require(_status == 0 , &quot;status must be producing&quot;);</span><br><span class="line">​    require(_owner == msg.sender,&quot;only trace can invoke contract &quot;);</span><br><span class="line">​    _timestamp.push(now);</span><br><span class="line">​    _traceName.push(traceName);</span><br><span class="line">​    _currentTraceName = traceName;</span><br><span class="line">​    _traceAddress.push(distributor);</span><br><span class="line">​    _quality = quality;</span><br><span class="line">​    _traceQuality.push(_quality);</span><br><span class="line">​    _status = 1;</span><br><span class="line">​    return true;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h4 id="（3）编写超市进行食品上链信息的接口"><a href="#（3）编写超市进行食品上链信息的接口" class="headerlink" title="（3）编写超市进行食品上链信息的接口"></a>（3）编写超市进行食品上链信息的接口</h4><p>根据食品溯源智能合约地址获取超市上链食品信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByRetailer(①, uint8 quality) public returns(bool) &#123;</span><br><span class="line">​    require(_status == 1 , &quot;status must be distributing&quot;);</span><br><span class="line">​    //②</span><br><span class="line">​    _timestamp.push(now);</span><br><span class="line">​    _traceName.push(traceName);</span><br><span class="line">​    _currentTraceName = traceName;</span><br><span class="line">​    //③</span><br><span class="line">​    //④</span><br><span class="line">​    _traceQuality.push(_quality);</span><br><span class="line">​    _status = 2;</span><br><span class="line">​    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-2"><a href="#答案：-2" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByRetailer(string traceName, address retailer, uint8 quality) public returns(bool) &#123;</span><br><span class="line">​    require(_status == 1 , &quot;status must be distributing&quot;);</span><br><span class="line">​    require(_owner == msg.sender,&quot;only trace can invoke contract&quot;)</span><br><span class="line">​    _timestamp.push(now);</span><br><span class="line">​    _traceName.push(traceName);</span><br><span class="line">​    _currentTraceName = traceName;</span><br><span class="line">​    _traceAddress.push(retailer);</span><br><span class="line">​    _quality = quality;</span><br><span class="line">​    _traceQuality.push(_quality);</span><br><span class="line">​    _status = 2;</span><br><span class="line">​    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-食品溯源-Trace-的接口编码"><a href="#2-食品溯源-Trace-的接口编码" class="headerlink" title="2.食品溯源(Trace)的接口编码"></a>2.食品溯源(Trace)的接口编码</h3><h4 id="（1）编写食品溯源智能合约生产商Producer添加食品接口"><a href="#（1）编写食品溯源智能合约生产商Producer添加食品接口" class="headerlink" title="（1）编写食品溯源智能合约生产商Producer添加食品接口"></a>（1）编写食品溯源智能合约生产商Producer添加食品接口</h4><p>必须生产商才能添加可溯源的食品，实现溯源功能；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function newFood(①, string traceName, uint8 quality)</span><br><span class="line">​	public ② returns(③)</span><br><span class="line">​    &#123;</span><br><span class="line">​      //④</span><br><span class="line">​      //⑤</span><br><span class="line">​      //⑥</span><br><span class="line">​      //⑦</span><br><span class="line">​      //⑧</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-3"><a href="#答案：-3" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function newFood(string name, uint256 traceNumber, string traceName, uint8 quality)</span><br><span class="line">​	public onlyProducer returns(address)</span><br><span class="line">​    &#123;</span><br><span class="line">​      require(foods[traceNumber] == address(0),&quot;traceNumber already exists&quot;);</span><br><span class="line">​      FoodInfoItem food = new FoodInfoItem(name,traceName,quality,msg.sender);</span><br><span class="line">​      foods[traceNumber] = food;</span><br><span class="line">​      foodList.push(traceNumber);</span><br><span class="line">​      return food;</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="（2）编写食品溯源智能合约分销商Distributor添加食品接口"><a href="#（2）编写食品溯源智能合约分销商Distributor添加食品接口" class="headerlink" title="（2）编写食品溯源智能合约分销商Distributor添加食品接口"></a>（2）编写食品溯源智能合约分销商Distributor添加食品接口</h4><p>必须分销商才能添加可溯源的食品，实现溯源功能；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByDistributor(①, uint8 quality)</span><br><span class="line">​	public ② returns(bool) &#123;</span><br><span class="line">​      //③</span><br><span class="line">​      return FoodInfoItem(foods[traceNumber]).④, quality);</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByDistributor(uint256 traceNumber,string traceName,uint8 quality)</span><br><span class="line">​	public onlyDistributor returns(bool) &#123;</span><br><span class="line">​      require(foods[traceNumber] != address(0),&quot;this traceNumber not exists&quot;);</span><br><span class="line">​      return FoodInfoItem(foods[traceNumber]).addTraceInfoByDistributor(traceName,msg.sender, quality);</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="（3）编写食品溯源智能合约超市Retailer添加食品接口"><a href="#（3）编写食品溯源智能合约超市Retailer添加食品接口" class="headerlink" title="（3）编写食品溯源智能合约超市Retailer添加食品接口"></a>（3）编写食品溯源智能合约超市Retailer添加食品接口</h4><p>必须超市才能添加可溯源的食品，实现溯源功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByRetailer(①, uint8 quality)</span><br><span class="line">​	public ② returns(bool) &#123;</span><br><span class="line">​      require(③,&quot;traceNumber doesn&#x27;t exists&quot;)</span><br><span class="line">​      return FoodInfoItem(foods[traceNumber]).④, quality);</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-4"><a href="#答案：-4" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function addTraceInfoByRetailer(uint256 traceNumber,string traceName, uint8 quality)</span><br><span class="line">​	public onlyRetailer returns(bool) &#123;</span><br><span class="line">​      require(foods[traceNumber] != address(0), &quot;traceNumber does not exist&quot;);</span><br><span class="line">​      return FoodInfoItem(foods[traceNumber]).addTraceInfoByRetailer(traceName ,msg.sender, quality);</span><br><span class="line">​    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-角色（Role）管理的接口编码"><a href="#3-角色（Role）管理的接口编码" class="headerlink" title="3.角色（Role）管理的接口编码"></a>3.角色（Role）管理的接口编码</h3><h4 id="（1）编写食品溯源增加角色接口"><a href="#（1）编写食品溯源增加角色接口" class="headerlink" title="（1）编写食品溯源增加角色接口"></a>（1）编写食品溯源增加角色接口</h4><p>必须是未增加的角色才能被添加，实现添加角色的功能；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function add(①, address account) ② &#123;</span><br><span class="line">​    require(!③, &quot;Roles: account already has role&quot;);</span><br><span class="line">​    role.④ = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-5"><a href="#答案：-5" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function add(Role storage role, address account) internal &#123;</span><br><span class="line">​    require(!has(role,account), &quot;Roles: account already has role&quot;);</span><br><span class="line">​    role.bearer[account] = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="（2）编写食品溯源移除角色接口"><a href="#（2）编写食品溯源移除角色接口" class="headerlink" title="（2）编写食品溯源移除角色接口"></a>（2）编写食品溯源移除角色接口</h4><p>必须是已增加的角色才能被移除，实现移除角色的功能； </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function remove(①, address account) ② &#123;</span><br><span class="line">​    require(③, &quot;Roles: account does not have role&quot;);</span><br><span class="line">​    role.④ = false;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案-1"><a href="#答案-1" class="headerlink" title="答案:"></a>答案:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function remove(Role storage role, address account) internal &#123;</span><br><span class="line">​    require(has(role,account), &quot;Roles: account does not have role&quot;);</span><br><span class="line">​    role.bearer[account] = false;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h4 id="（3）编写食品溯源角色授权接口"><a href="#（3）编写食品溯源角色授权接口" class="headerlink" title="（3）编写食品溯源角色授权接口"></a>（3）编写食品溯源角色授权接口</h4><p>必须是授权的角色地址，实现角色权限管理功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function has(①, address account) ② returns (bool) &#123;</span><br><span class="line">​    require(③, &quot;Roles: account is the zero address&quot;);</span><br><span class="line">​    return role.④;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="答案：-6"><a href="#答案：-6" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function has(Role storage role, address account) ② returns (bool) &#123;</span><br><span class="line">​    require(account != addres(0), &quot;Roles: account is the zero address&quot;);</span><br><span class="line">​    return role.bearer[account];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-合约编译、部署和调用"><a href="#4-合约编译、部署和调用" class="headerlink" title="4.合约编译、部署和调用"></a>4.合约编译、部署和调用</h3><h4 id="（1）合约地址-abi"><a href="#（1）合约地址-abi" class="headerlink" title="（1）合约地址 &amp; abi"></a>（1）合约地址 &amp; abi</h4><p>解决代码错误和警告，正确编译并部署合约，成功获取部署的合约地址和abi；</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103101746928.png" alt="image-20241103101746928"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103101820273.png" alt="image-20241103101820273"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103101857873.png" alt="image-20241103101857873"></p>
<h4 id="（2）合约接口"><a href="#（2）合约接口" class="headerlink" title="（2）合约接口"></a>（2）合约接口</h4><p>调用食品溯源智能合约的接口，完整验证业务流程。</p>
<h5 id="调用-newFood-方法："><a href="#调用-newFood-方法：" class="headerlink" title="调用 newFood 方法："></a>调用 newFood 方法：</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102047144.png" alt="image-20241103102047144"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102130768.png" alt="image-20241103102130768"></p>
<h5 id="调用-addTraceInfoByDistributor-："><a href="#调用-addTraceInfoByDistributor-：" class="headerlink" title="调用 addTraceInfoByDistributor ："></a>调用 addTraceInfoByDistributor ：</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102246683.png" alt="image-20241103102246683"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102424402.png" alt="image-20241103102424402"></p>
<h5 id="调用-addTraceInfoByRetailer-方法："><a href="#调用-addTraceInfoByRetailer-方法：" class="headerlink" title="调用 addTraceInfoByRetailer 方法："></a>调用 addTraceInfoByRetailer 方法：</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102513061.png" alt="image-20241103102513061"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102557673.png" alt="image-20241103102557673"></p>
<h5 id="调用-getFood-方法："><a href="#调用-getFood-方法：" class="headerlink" title="调用 getFood 方法："></a>调用 getFood 方法：</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102639084.png" alt="image-20241103102639084"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102657614.png" alt="image-20241103102657614"></p>
<h5 id="调用-getTraceInfo-方法："><a href="#调用-getTraceInfo-方法：" class="headerlink" title="调用 getTraceInfo 方法："></a>调用 getTraceInfo 方法：</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102733682.png" alt="image-20241103102733682"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102749157.png" alt="image-20241103102749157"></p>
<h5 id="调用-getAllFood-方法："><a href="#调用-getAllFood-方法：" class="headerlink" title="调用 getAllFood 方法："></a>调用 getAllFood 方法：</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102825291.png" alt="image-20241103102825291"></h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241103102916799.png" alt="image-20241103102916799"></p>
<h2 id="任务2-3：智能合约测试"><a href="#任务2-3：智能合约测试" class="headerlink" title="任务2-3：智能合约测试"></a>任务2-3：智能合约测试</h2><p>编写智能合约单元测试代码并完成合约功能测试、性能测试，具体要求如下：</p>
<p>1.配置区块链网络</p>
<p>启动区块链网络，创建新的Workspace，配置对外访问的RPC接口为7545，配置项目的配置文件config.js实现与新建Workspace的连接。</p>
<p>2.设置producerId和sellederId两个变量</p>
<p>基于VSCODE加载测试项目，补全位于test文件夹中foodTraceNew.js文件预操作的方法。在测试文件中添加预定义的方法（在其他方法启动前使用），在方法中分别设置producerId和sellederId两个变量，具体要求如下：</p>
<p>（1）producerId设置为1；</p>
<p>（2）sellderId设置为4。</p>
<p>3.补全createMember和getMember方法</p>
<p>基于VSCODE加载的测试项目，补全位于test文件夹中foodTraceNew.js文件，添加测试用例，测试智能合约的createMember和getMember方法。</p>
<p>4.测试createOrder和getOrder方法</p>
<p>基于VSCODE加载的测试项目，补全位于test文件夹中foodTraceNew.js文件，添加测试用例，测试智能合约的createOrder和getOrder方法。</p>
<p>5.测试createFood和getFood方法</p>
<p>基于VSCODE加载的测试项目，补全位于test文件夹中foodTraceNew.js文件，添加测试用例，测试智能合约的createFood和getFood方法。</p>
<h1 id="模块三"><a href="#模块三" class="headerlink" title="模块三"></a>模块三</h1><h2 id="任务3-1：区块链应用前端功能开发"><a href="#任务3-1：区块链应用前端功能开发" class="headerlink" title="任务3-1：区块链应用前端功能开发"></a>任务3-1：区块链应用前端功能开发</h2><h3 id="1．请基于前端系统的开发模板，在登录组件login-js、组件管理文件components-js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下："><a href="#1．请基于前端系统的开发模板，在登录组件login-js、组件管理文件components-js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：" class="headerlink" title="1．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下："></a>1．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：</h3><p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml60876\wps5.jpg" alt="img"> </p>
<p> 具体要求如下：</p>
<p>（1）有明确的提示，提示用户选择角色；</p>
<p>（2）用户可看到四个不同的角色可选（生产商、中间商、超市、消费者）；</p>
<p>（3）每个用户所对应的组件请在components中找寻并填入；</p>
<p>（4）页面顶部要有食品溯源平台的网站标题和logo。</p>
<h4 id="填写Login-js"><a href="#填写Login-js" class="headerlink" title="填写Login.js:"></a>填写Login.js:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段1：</span></span><br><span class="line"><span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;div class=&quot;login&quot;&gt;</span></span><br><span class="line"><span class="string">   &lt;!-- 角色选择 --&gt;</span></span><br><span class="line"><span class="string">   &lt;h3 v-if=&quot;currentUser === null&quot;&gt;选手填写部分&lt;/h3&gt;</span></span><br><span class="line"><span class="string">   &lt;el-row :gutter=&quot;80&quot;  v-if=&quot;currentUser === null&quot;&gt;</span></span><br><span class="line"><span class="string">​    &lt;el-col :span=&quot;6&quot; v-for=&quot;选手填写部分&quot; :key=&quot;index&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;div @click=&quot;选手填写部分&quot;&gt;选手填写部分&lt;/div&gt;</span></span><br><span class="line"><span class="string">​    &lt;/el-col&gt;</span></span><br><span class="line"><span class="string">   &lt;/el-row&gt;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>

<h4 id="答案-2"><a href="#答案-2" class="headerlink" title="答案:"></a>答案:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;div class=&quot;login&quot;&gt;</span></span><br><span class="line"><span class="string">     &lt;!-- 角色选择 --&gt;</span></span><br><span class="line"><span class="string">     &lt;h3 v-if=&quot;currentUser === null&quot;&gt;请选择您的角色&lt;/h3&gt;</span></span><br><span class="line"><span class="string">     &lt;el-row :gutter=&quot;80&quot;  v-if=&quot;currentUser === null&quot;&gt;</span></span><br><span class="line"><span class="string">       &lt;el-col :span=&quot;6&quot; v-for=&quot;(item,index) in users&quot; :key=&quot;index&quot;&gt;</span></span><br><span class="line"><span class="string">         &lt;div @click=&quot;handleClick(item)&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">       &lt;/el-col&gt;</span></span><br><span class="line"><span class="string">     &lt;/el-row&gt;</span></span><br><span class="line"><span class="string">     `</span></span><br></pre></td></tr></table></figure>

<h4 id="填写Login-js-1"><a href="#填写Login-js-1" class="headerlink" title="填写Login.js:"></a>填写Login.js:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段2：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户身份</span></span><br><span class="line">   <span class="attr">users</span>: [</span><br><span class="line">​    &#123;</span><br><span class="line">​     <span class="attr">name</span>: 选手填写部分,</span><br><span class="line">​     <span class="attr">userName</span>: <span class="string">&#x27;producer&#x27;</span>,</span><br><span class="line">​     <span class="attr">component</span>: 选手填写部分,</span><br><span class="line">​    &#125;,</span><br><span class="line">​    &#123;</span><br><span class="line">​     <span class="attr">name</span>: 选手填写部分,</span><br><span class="line">​     <span class="attr">userName</span>: <span class="string">&#x27;distributor&#x27;</span>,</span><br><span class="line">​     <span class="attr">component</span>: 选手填写部分,</span><br><span class="line">​    &#125;,</span><br><span class="line">​    &#123;</span><br><span class="line">​     <span class="attr">name</span>: 选手填写部分,</span><br><span class="line">​     <span class="attr">userName</span>: <span class="string">&#x27;retailer&#x27;</span>,</span><br><span class="line">​     <span class="attr">component</span>: 选手填写部分,</span><br><span class="line">​    &#125;,</span><br><span class="line">​    &#123;</span><br><span class="line">​     <span class="attr">name</span>: 选手填写部分,</span><br><span class="line">​     <span class="attr">userName</span>: <span class="string">&#x27;consumer&#x27;</span>,</span><br><span class="line">​     <span class="attr">component</span>: 选手填写部分,</span><br><span class="line">​    &#125;,</span><br><span class="line">   ],</span><br><span class="line">   <span class="attr">currentUser</span>: 选手填写部分, <span class="comment">// 当前用户</span></span><br></pre></td></tr></table></figure>

<h4 id="答案：-7"><a href="#答案：-7" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">users</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;生产者&quot;</span>,</span><br><span class="line">    <span class="attr">userName</span>: <span class="string">&#x27;producer&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Farm</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;分销商&quot;</span>,</span><br><span class="line">    <span class="attr">userName</span>: <span class="string">&#x27;distributor&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Agent</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;超市&quot;</span>,</span><br><span class="line">    <span class="attr">userName</span>: <span class="string">&#x27;retailer&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Mall</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;消费者&quot;</span>,</span><br><span class="line">    <span class="attr">userName</span>: <span class="string">&#x27;consumer&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Consumer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br><span class="line"><span class="attr">currentUser</span>: <span class="literal">null</span>, <span class="comment">// 当前用户</span></span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 角色地址</span></span><br><span class="line"><span class="attr">countdown</span>: <span class="number">5</span>, <span class="comment">// 倒计时时间</span></span><br><span class="line"><span class="attr">loginItem</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 登录用户信息</span></span><br><span class="line"><span class="attr">timer</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 处理倒计时的定时器</span></span><br></pre></td></tr></table></figure>



<h4 id="填写component-js"><a href="#填写component-js" class="headerlink" title="填写component.js"></a>填写component.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段3：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 头部组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Header</span> = &#123;</span><br><span class="line"> <span class="comment">// 接受传入的登录状态、用户信息</span></span><br><span class="line"> <span class="attr">props</span>: [<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line"> <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">​      &lt;img src=&quot;选手填写部分&quot; /&gt;</span></span><br><span class="line"><span class="string">   &lt;h3&gt;选手填写部分&lt;/h3&gt;</span></span><br><span class="line"><span class="string">   &lt;span v-if=&quot;login&quot; class=&quot;user-name&quot;&gt;&#123;&#123; 选手填写部分 &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="答案：-8"><a href="#答案：-8" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 头部组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Header</span> = &#123;</span><br><span class="line">  <span class="comment">// 接受传入的登录状态、用户信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;img src=&quot;C:\\Users\\Administrator\\Desktop\\fsdownload\\FoodTraceability\\backend\\src\\main\\resources\\static\\images\\logo.png&quot;/&gt;</span></span><br><span class="line"><span class="string">      &lt;h3&gt;食物溯源平台&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;span v-if=&quot;login&quot; class=&quot;user-name&quot;&gt;&#123;&#123;user&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h3 id="2．请基于前端系统的开发模板，在登录组件login-js、组件管理文件components-js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下："><a href="#2．请基于前端系统的开发模板，在登录组件login-js、组件管理文件components-js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：" class="headerlink" title="2．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下："></a>2．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：</h3><p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml60876\wps9.png" alt="img"> </p>
<p><img src="file:///C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml60876\wps10.png" alt="img"> </p>
<p>具体要求如下：</p>
<p>（1）点击角色进入相应角色登录页面；</p>
<p>（2）登录界面提示用户的地址（消费者不显示），有登录操作的相关提示；</p>
<p>（3）登录界面有5秒倒计时；</p>
<p>（4）登录界面有“直接登录”按钮，点击可直接跳转到相应角色首页。</p>
<h4 id="填写Login-js-2"><a href="#填写Login-js-2" class="headerlink" title="填写Login.js:"></a>填写Login.js:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段1：</span></span><br><span class="line"></span><br><span class="line">&lt;!-- 角色登录 --&gt;</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;is-login&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>登录中......(倒计时：&#123;&#123; 选手填写部分&#125;&#125; 秒)<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>角色: </span></span><br><span class="line"><span class="language-xml">​     <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; 选手填写部分&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="comment">&lt;!-- 非消费者则显示角色地址 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;选手填写部分&quot;</span>&gt;</span>角色地址:</span></span><br><span class="line"><span class="language-xml">​     <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; 选手填写部分&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="comment">&lt;!-- 直接登录按钮 --&gt;</span></span></span><br><span class="line"><span class="language-xml">​    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">选手填写部分</span>&gt;</span>直接登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="答案：-9"><a href="#答案：-9" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 角色登录 --&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;is-login&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>登录中......(倒计时：&#123;&#123; countdown &#125;&#125; 秒)<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>角色: </span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;currentUser&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 非消费者则显示角色地址 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;currentUser !== &#x27;消费者&#x27;&quot;</span>&gt;</span>角色地址:</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;address&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 直接登录按钮 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;clearTimer&quot;</span>&gt;</span>直接登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="填写Login-js-3"><a href="#填写Login-js-3" class="headerlink" title="填写Login.js:"></a>填写Login.js:</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段2：</span></span><br><span class="line"><span class="comment">// 登录时有个5秒的倒计时，这里是在点击直接登录时，清除倒计时，直接跳到相关页面</span></span><br><span class="line">  <span class="title function_">clearTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="built_in">clearInterval</span>(选手填写部分);</span><br><span class="line">   <span class="variable language_">this</span>.$emit(选手填写部分, &#123; </span><br><span class="line">​    <span class="attr">component</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">component</span>, </span><br><span class="line">​    <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">name</span>, </span><br><span class="line">   &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 倒计时</span></span><br><span class="line">  <span class="title function_">countdownInterval</span>(<span class="params">&#123; component, name: user &#125;</span>) &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">​    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">countdown</span> &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">​     选手填写部分;</span><br><span class="line">​    &#125;</span><br><span class="line">​    选手填写部分;</span><br><span class="line">   &#125;, 选手填写部分);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="答案-3"><a href="#答案-3" class="headerlink" title="答案"></a>答案</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clearTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">component</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">component</span>, </span><br><span class="line">        <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">name</span>, </span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 倒计时</span></span><br><span class="line">    <span class="title function_">countdownInterval</span>(<span class="params">&#123; component, name: user &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">countdown</span> &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">clearTimer</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">countdown</span> -= <span class="number">1</span>;</span><br><span class="line">      &#125;,  <span class="number">1000</span>);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="填写Login-js-4"><a href="#填写Login-js-4" class="headerlink" title="填写Login.js"></a>填写Login.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码片段3：</span></span><br><span class="line"><span class="comment">// 点击用户登录，获取用户地址</span></span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params">item</span>) &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">loginItem</span> = item;</span><br><span class="line">   <span class="comment">// 处理消费者角色，其他三个角色都有一个角色地址</span></span><br><span class="line">   <span class="keyword">if</span> (item.<span class="property">userName</span> !== 选手填写部分) &#123;</span><br><span class="line">​    <span class="title function_">axios</span>(&#123;</span><br><span class="line">​     <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">​     <span class="attr">url</span>: <span class="string">`/userinfo?userName=<span class="subst">$&#123;item.userName&#125;</span>`</span><span class="string">`,</span></span><br><span class="line"><span class="string">​    &#125;)</span></span><br><span class="line"><span class="string">​    .then(ret =&gt; &#123;</span></span><br><span class="line"><span class="string">​     this.address = 选手填写部分;</span></span><br><span class="line"><span class="string">​     this.currentUser = 选手填写部分;</span></span><br><span class="line"><span class="string">​     this.countdownInterval(选手填写部分);</span></span><br><span class="line"><span class="string">​    &#125;) </span></span><br><span class="line"><span class="string">​    .catch(err =&gt; &#123;</span></span><br><span class="line"><span class="string">​     console.log(err)</span></span><br><span class="line"><span class="string">​    &#125;)</span></span><br><span class="line"><span class="string">   &#125; else &#123;</span></span><br><span class="line"><span class="string">​    this.currentUser = item.name;</span></span><br><span class="line"><span class="string">​    this.countdownInterval(item);</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="答案：-10"><a href="#答案：-10" class="headerlink" title="答案："></a>答案：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击用户登录，获取用户地址</span></span><br><span class="line">    <span class="title function_">handleClick</span>(<span class="params">item</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">loginItem</span> = item;</span><br><span class="line">      <span class="comment">// 处理消费者角色，其他三个角色都有一个角色地址</span></span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">userName</span> !== <span class="string">&#x27;consumer&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">axios</span>(&#123;</span><br><span class="line">          <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/userinfo?userName=<span class="subst">$&#123;item.userName&#125;</span>`</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">address</span> = ret.<span class="property">data</span>.<span class="property">address</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentUser</span> = item.<span class="property">name</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">countdownInterval</span>(item);</span><br><span class="line">        &#125;) </span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentUser</span> = item.<span class="property">name</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">countdownInterval</span>(item);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="任务3-2：区块链应用后端功能开发"><a href="#任务3-2：区块链应用后端功能开发" class="headerlink" title="任务3-2：区块链应用后端功能开发"></a>任务3-2：区块链应用后端功能开发</h2><h3 id="1．请基于已有的项目，开发完善IndexController类，编写添加食品生产信息的方法，实现食品信息的添加功能，并测试功能完整性。"><a href="#1．请基于已有的项目，开发完善IndexController类，编写添加食品生产信息的方法，实现食品信息的添加功能，并测试功能完整性。" class="headerlink" title="1．请基于已有的项目，开发完善IndexController类，编写添加食品生产信息的方法，实现食品信息的添加功能，并测试功能完整性。"></a>1．请基于已有的项目，开发完善IndexController类，编写添加食品生产信息的方法，实现食品信息的添加功能，并测试功能完整性。</h3><p>本任务具体要求如下：</p>
<p>（1）开发文件IndexController.java中的produce方法，请求接口为&#x2F;produce；</p>
<p>（2）开发文件IndexController.java中的produce方法，要求对前端传入的参数进行二次验证；</p>
<p>（3）开发文件IndexController.java中的produce方法，要求封装返回值为String，但不返回视图页面。</p>
<h4 id="填写produce方法"><a href="#填写produce方法" class="headerlink" title="填写produce方法:"></a>填写produce方法:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 添加食品生产信息</span></span><br><span class="line"><span class="comment">  * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * foodName: 食物名称</span></span><br><span class="line"><span class="comment">  * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">  * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span>：添加食品生产信息结果</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  @选手填写部分</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(选手填写部分, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">produce</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line"></span><br><span class="line">​    <span class="comment">//声明返回对象</span></span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    <span class="comment">//生产商生产食品</span></span><br><span class="line">​    <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">​      选手填写部分</span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">​    <span class="type">int</span> <span class="variable">trace_number</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">String</span> <span class="variable">food_name</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray([\<span class="string">&quot;&quot;</span>+food_name+<span class="string">&quot;\&quot;,&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;user&quot;</span>,PRODUCER_ADDRESS);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,选手填写部分);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,选手填写部分);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">​    <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,选手填写部分);</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">​    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">​    <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;ret&quot;</span>,选手填写部分);</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">​    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;ret&quot;</span>,选手填写部分);</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> 选手填写部分;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="producer答案："><a href="#producer答案：" class="headerlink" title="producer答案："></a>producer答案：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 添加食品生产信息</span></span><br><span class="line"><span class="comment">  * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * foodName: 食物名称</span></span><br><span class="line"><span class="comment">  * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">  * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span>：添加食品生产信息结果</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@PostMapping(path = &quot;/produce&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">produce</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//声明返回对象</span></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//生产商生产食品</span></span><br><span class="line">     <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="type">int</span> <span class="variable">trace_number</span> <span class="operator">=</span> (<span class="type">int</span>)jsonParam.get(<span class="string">&quot;traceNumber&quot;</span>);</span><br><span class="line">     <span class="type">String</span> <span class="variable">food_name</span> <span class="operator">=</span> (String)jsonParam.get(<span class="string">&quot;foodName&quot;</span>);</span><br><span class="line">     <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> (String)jsonParam.get(<span class="string">&quot;traceName&quot;</span>);</span><br><span class="line">     <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> (<span class="type">int</span>)jsonParam.get(<span class="string">&quot;quality&quot;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[\&quot;&quot;</span>+food_name+<span class="string">&quot;\&quot;,&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;user&quot;</span>,PRODUCER_ADDRESS);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;newFood&quot;</span>);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">     <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">1</span>);</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">0</span>);</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="postman测试：正确的添加"><a href="#postman测试：正确的添加" class="headerlink" title="postman测试：正确的添加"></a>postman测试：正确的添加</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031200320173.png" alt="image-20241031200320173"></p>
<h4 id="postman测试：错误的添加"><a href="#postman测试：错误的添加" class="headerlink" title="postman测试：错误的添加"></a>postman测试：错误的添加</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031200453457.png" alt="image-20241031200453457"></p>
<h3 id="2．开发完善IndexController类，编写中间商添加食品流转信息的方法，实现中间商添加食品流转信息的功能，并测试功能完整性。"><a href="#2．开发完善IndexController类，编写中间商添加食品流转信息的方法，实现中间商添加食品流转信息的功能，并测试功能完整性。" class="headerlink" title="2．开发完善IndexController类，编写中间商添加食品流转信息的方法，实现中间商添加食品流转信息的功能，并测试功能完整性。"></a>2．开发完善IndexController类，编写中间商添加食品流转信息的方法，实现中间商添加食品流转信息的功能，并测试功能完整性。</h3><p>具体要求如下：</p>
<p>（1）开发文件IndexController.java中的add_trace_by_distrubutor方法，请求接口为&#x2F;adddistribution；</p>
<p>（2）开发文件IndexController.java中的add_trace_by_distrubutor方法，要求对前端传入的参数进行二次验证；</p>
<p>（3）开发文件IndexController.java中的add_trace_by_distrubutor方法，要求封装返回值为String，但不返回视图页面；</p>
<h4 id="填写add-trace-by-distrubutor方法"><a href="#填写add-trace-by-distrubutor方法" class="headerlink" title="填写add_trace_by_distrubutor方法:"></a>填写add_trace_by_distrubutor方法:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 中间商添加食品流转信息</span></span><br><span class="line"><span class="comment">  * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">  * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span>：中间商添加食品流转信息结果</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  @选手填写部分</span><br><span class="line">  <span class="meta">@PostMapping(选手填写部分, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">add_trace_by_distrubutor</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line">​    <span class="comment">//声明返回对象</span></span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">​      选手填写部分</span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="type">String</span> <span class="variable">trace_number</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line"></span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;user&quot;</span>,DISTRIBUTOR_ADDRESS);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,选手填写部分);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,选手填写部分);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">​    <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,选手填写部分);</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">​    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">​    <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;ret&quot;</span>,选手填写部分);</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">​    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;ret&quot;</span>,选手填写部分);</span><br><span class="line">​      _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> 选手填写部分;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="答案-4"><a href="#答案-4" class="headerlink" title="答案:"></a>答案:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 中间商添加食品流转信息</span></span><br><span class="line"><span class="comment">  * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">  * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span>：中间商添加食品流转信息结果</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@PostMapping(path=&quot;adddistribution&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">add_trace_by_distrubutor</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line">     <span class="comment">//声明返回对象</span></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">trace_number</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceNumber&quot;</span>);</span><br><span class="line">     <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceName&quot;</span>);</span><br><span class="line">     <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> (<span class="type">int</span>) jsonParam.get(<span class="string">&quot;quality&quot;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;user&quot;</span>,DISTRIBUTOR_ADDRESS);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;addTraceInfoByDistributor&quot;</span>);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">     <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">1</span>);</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">0</span>);</span><br><span class="line">         _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="postman测试：正确的添加-1"><a href="#postman测试：正确的添加-1" class="headerlink" title="postman测试：正确的添加"></a>postman测试：正确的添加</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031200813598.png" alt="image-20241031200813598"></p>
<h4 id="postman测试：错误的添加-1"><a href="#postman测试：错误的添加-1" class="headerlink" title="postman测试：错误的添加"></a>postman测试：错误的添加</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031200855896.png" alt="image-20241031200855896"></p>
<h3 id="3．请基于已有的项目，开发完善IndexController类，编写获取某个食品的溯源信息的方法，实现获取某个食品的溯源信息的功能，并测试功能完整性。"><a href="#3．请基于已有的项目，开发完善IndexController类，编写获取某个食品的溯源信息的方法，实现获取某个食品的溯源信息的功能，并测试功能完整性。" class="headerlink" title="3．请基于已有的项目，开发完善IndexController类，编写获取某个食品的溯源信息的方法，实现获取某个食品的溯源信息的功能，并测试功能完整性。"></a>3．请基于已有的项目，开发完善IndexController类，编写获取某个食品的溯源信息的方法，实现获取某个食品的溯源信息的功能，并测试功能完整性。</h3><p>具体要求如下：</p>
<p>（1）开发文件IndexController.java中的trace方法，请求接口为&#x2F;trace，该接口调用私有方法get_trace，不直接与合约交互，提高系统的安全性；</p>
<p>（2）开发文件IndexController.java中的trace方法，对传入数据进行二次验证；</p>
<p>（3）开发文件IndexController.java中的get_trace方法，要求通过合约进行溯源信息的查询，且外部无法直接调用；</p>
<p>（4）开发文件IndexController.java中的trace方法，要求封装返回值为String，但不返回视图页面。</p>
<h4 id="填写trace方法"><a href="#填写trace方法" class="headerlink" title="填写trace方法:"></a>填写trace方法:</h4> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  @选手填写部分</span><br><span class="line">  <span class="meta">@GetMapping(选手填写部分, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    <span class="keyword">if</span> (Integer.parseInt(traceNumber) &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">​      选手填写部分</span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    <span class="type">List</span> <span class="variable">res</span> <span class="operator">=</span> get_trace(traceNumber);</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(res);</span><br><span class="line">​    <span class="keyword">return</span> 选手填写部分;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="答案-5"><a href="#答案-5" class="headerlink" title="答案:"></a>答案:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@GetMapping(path=&quot;/trace&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"> <span class="keyword">public</span> String <span class="title function_">trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (Integer.parseInt(traceNumber) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         _outPut.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> _outPut.toJSONString();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="type">List</span> <span class="variable">res</span> <span class="operator">=</span> get_trace(traceNumber);</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(res);</span><br><span class="line">     <span class="keyword">return</span> o.toJSONString();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h4 id="填写get-trace方法："><a href="#填写get-trace方法：" class="headerlink" title="填写get_trace方法："></a>填写get_trace方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 从链上获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  选手填写部分JSONArray <span class="title function_">get_trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line">​    <span class="comment">//获取食品基本信息</span></span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+traceNumber+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,选手填写部分);</span><br><span class="line">​    _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,选手填写部分);</span><br><span class="line"></span><br><span class="line">​    <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,选手填写部分);</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">food</span>  <span class="operator">=</span> JSON.parseArray(responseStr);</span><br><span class="line"></span><br><span class="line">​    <span class="comment">//获取食品溯源信息</span></span><br><span class="line">​    <span class="type">JSONObject</span> <span class="variable">_jsonObj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;funcName&quot;</span>,选手填写部分);</span><br><span class="line">​    _jsonObj2.put(<span class="string">&quot;funcParam&quot;</span>,选手填写部分);</span><br><span class="line"></span><br><span class="line">​    <span class="type">String</span> <span class="variable">responseStr2</span> <span class="operator">=</span> httpPost(URL,选手填写部分);</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">traceInfoList</span>  <span class="operator">=</span> JSON.parseArray(responseStr2);</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">time_list</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">name_list</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">address_list</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">quality_list</span> <span class="operator">=</span> 选手填写部分;</span><br><span class="line"></span><br><span class="line">​    <span class="type">JSONArray</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">​    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;time_list.size();i++)&#123;</span><br><span class="line">​      <span class="keyword">if</span> (i==<span class="number">0</span>)&#123;</span><br><span class="line">​        <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;name&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;from&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;quality&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPut.add(_outPutObj);</span><br><span class="line">​      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">​        <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;name&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;from&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;to&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;quality&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPutObj.put(<span class="string">&quot;to_address&quot;</span>,选手填写部分);</span><br><span class="line">​        _outPut.add(_outPutObj);</span><br><span class="line">​      &#125;</span><br><span class="line">​    &#125;</span><br><span class="line">​    <span class="keyword">return</span> _outPut;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="答案-6"><a href="#答案-6" class="headerlink" title="答案:"></a>答案:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 从链上获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> JSONArray <span class="title function_">get_trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line">     <span class="comment">//获取食品基本信息</span></span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+traceNumber+<span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getFood&quot;</span>);</span><br><span class="line">     _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">food</span>  <span class="operator">=</span> JSON.parseArray(responseStr);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//获取食品溯源信息</span></span><br><span class="line">     <span class="type">JSONObject</span> <span class="variable">_jsonObj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getTraceInfo&quot;</span>);</span><br><span class="line">     _jsonObj2.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">     <span class="type">String</span> <span class="variable">responseStr2</span> <span class="operator">=</span> httpPost(URL,_jsonObj2.toJSONString());</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">traceInfoList</span>  <span class="operator">=</span> JSON.parseArray(responseStr2);</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">time_list</span> <span class="operator">=</span> JSON.parseArray(traceInfoList.get(<span class="number">0</span>).toString());</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">name_list</span> <span class="operator">=</span> JSON.parseArray((String)traceInfoList.get(<span class="number">1</span>));</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">address_list</span> <span class="operator">=</span>JSON.parseArray((String)traceInfoList.get(<span class="number">2</span>));</span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">quality_list</span> <span class="operator">=</span> JSON.parseArray((String)traceInfoList.get(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">     <span class="type">JSONArray</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;time_list.size();i++)&#123;</span><br><span class="line">         <span class="keyword">if</span> (i==<span class="number">0</span>)&#123;</span><br><span class="line">             <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>, traceNumber);</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;name&quot;</span>,food.get(<span class="number">2</span>));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,FormatTime(Long.parseLong(food.get(<span class="number">0</span>).toString())));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>, FormatTime((Long) time_list.get(i)));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;from&quot;</span>,name_list.get(i));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;quality&quot;</span>,quality_list.get(i));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,address_list.get(i));</span><br><span class="line">             _outPut.add(_outPutObj);</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>,traceNumber);</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;name&quot;</span>,food.get(<span class="number">2</span>));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,FormatTime(Long.parseLong(food.get(<span class="number">0</span>).toString())));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>,FormatTime((Long) time_list.get(i)));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;from&quot;</span>,name_list.get(i-<span class="number">1</span>));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;to&quot;</span>,name_list.get(i));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;quality&quot;</span>,quality_list.get(i));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,address_list.get(i-<span class="number">1</span>));</span><br><span class="line">             _outPutObj.put(<span class="string">&quot;to_address&quot;</span>,address_list.get(i));</span><br><span class="line">             _outPut.add(_outPutObj);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> _outPut;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="postman测试：正确的查询"><a href="#postman测试：正确的查询" class="headerlink" title="postman测试：正确的查询"></a>postman测试：正确的查询</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031201059482.png" alt="image-20241031201059482"></p>
<h4 id="postman测试：错误的查询"><a href="#postman测试：错误的查询" class="headerlink" title="postman测试：错误的查询"></a>postman测试：错误的查询</h4><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20241031201154138.png" alt="image-20241031201154138"></p>
<h2 id="全部代码（部分修改）"><a href="#全部代码（部分修改）" class="headerlink" title="全部代码（部分修改）"></a>全部代码（部分修改）</h2><h3 id="前端："><a href="#前端：" class="headerlink" title="前端："></a>前端：</h3><h4 id="components-js"><a href="#components-js" class="headerlink" title="components.js"></a>components.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日期时间格式处理，把日期统一转化成 YYYY-MM-DD hh:mm:ss 的格式</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">dateTime</span> = time =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> newDate = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">  <span class="keyword">let</span> dateCollection = &#123; <span class="attr">y</span>: newDate.<span class="title function_">getFullYear</span>(), <span class="attr">M</span>: newDate.<span class="title function_">getMonth</span>() + <span class="number">1</span>, <span class="attr">d</span>: newDate.<span class="title function_">getDate</span>(), <span class="attr">h</span>: newDate.<span class="title function_">getHours</span>(), <span class="attr">m</span>: newDate.<span class="title function_">getMinutes</span>(), <span class="attr">s</span>: newDate.<span class="title function_">getSeconds</span>() &#125;;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> dateCollection) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dateCollection[i] &lt; <span class="number">10</span>) dateCollection[i] = <span class="string">`0<span class="subst">$&#123;dateCollection[i]&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> &#123; y, M, d, h, m, s &#125; = dateCollection;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;y&#125;</span>-<span class="subst">$&#123;M&#125;</span>-<span class="subst">$&#123;d&#125;</span> <span class="subst">$&#123;h&#125;</span>:<span class="subst">$&#123;m&#125;</span>:<span class="subst">$&#123;s&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 头部组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Header</span> = &#123;</span><br><span class="line">  <span class="comment">// 接受传入的登录状态、用户信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;img src=&quot;C:\\Users\\Administrator\\Desktop\\fsdownload\\FoodTraceability\\backend\\src\\main\\resources\\static\\images\\logo.png&quot;/&gt;</span></span><br><span class="line"><span class="string">      &lt;h3&gt;食物溯源平台&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;span v-if=&quot;login&quot; class=&quot;user-name&quot;&gt;&#123;&#123;user&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 食品详情展示</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FoodDetail</span> = &#123;</span><br><span class="line">  <span class="comment">// 接受传入的食品详情信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;food&#x27;</span>],</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 日期转换</span></span><br><span class="line">    <span class="title function_">date</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">food</span>.<span class="property">timestamp</span>) <span class="keyword">return</span> <span class="title function_">dateTime</span>(<span class="variable language_">this</span>.<span class="property">food</span>.<span class="property">timestamp</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;fooddetail&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h4&gt;食品基本信息&lt;/h4&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;content trace-content&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;生产商地址&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123; food.from_address || food.address &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;溯源码&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123; food.traceNumber &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;食品名称&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123; food.name &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;生产商&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123; food.from || food.produce &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;生产时间&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123; date &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 溯源详情展示</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TraceDetail</span> = &#123;</span><br><span class="line">  <span class="comment">// 食品详情子组件，FoodDetail 展示的是农场部分的信息</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">FoodDetail</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接受传入的溯源详情信息，及用户信息；foodDetail为数组，第一个数组元素为农场溯源信息、第二个数组元素为中间商溯源信息、第三个数组元素为超市溯源信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;foodDetail&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>:<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 class=&quot;trace-title&quot;&gt;以下是溯源码为&#123;&#123;foodDetail[0].traceNumber&#125;&#125;的溯源信息&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;tracedetail&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;!-- 农场部分的溯源详情 --&gt;</span></span><br><span class="line"><span class="string">        &lt;!-- 农场部分的溯源详情 --&gt;</span></span><br><span class="line"><span class="string">        &lt;FoodDetail :food=&quot;foodDetail[0]&quot; /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;!-- 根据 foodDetail 的溯源细节，决定是否展示相关阶段的溯源信息， user: 2 为 超市， user: 3 为消费者 --&gt;</span></span><br><span class="line"><span class="string">        &lt;el-divider v-if=&quot;foodDetail[1] &amp;&amp; (user === 2 || user === 3)&quot;&gt;&lt;/el-divider&gt;</span></span><br><span class="line"><span class="string">        &lt;div v-if=&quot;foodDetail[1] &amp;&amp; (user === 2 || user === 3)&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;h4&gt;食品流通信息&lt;/h4&gt;</span></span><br><span class="line"><span class="string">          &lt;div  class=&quot;trace-timeline trace-content&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;el-timeline&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item class=&quot;el-timeline-no-node el-timeline-no-tail&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;中间商地址&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[1].to_address &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;入库时间&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; dateTime(foodDetail[1].timestamp) &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;质检情况&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[1].quality === 0 ? &#x27;优质&#x27; : foodDetail[1].quality === 1 ? &#x27;合格&#x27; : &#x27;不合格&#x27; &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;发货单位&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[1].from &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item  style=&quot;height:60px;&quot; class=&quot;el-timeline-no-tail&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;收货单位&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[1].to &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;!-- 根据 foodDetail 的溯源细节，决定是否展示相关阶段的溯源信息， user: 3 为消费者 --&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item class=&quot;el-timeline-no-node el-timeline-no-tail&quot; v-if=&quot;foodDetail[2] &amp;&amp; user === 3&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;超市地址&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[2].to_address &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item v-if=&quot;foodDetail[2] &amp;&amp; user === 3&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;入库时间&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; dateTime(foodDetail[2].timestamp) &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item v-if=&quot;foodDetail[2] &amp;&amp; user === 3&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;质检情况&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[2].quality === 0 ? &#x27;优质&#x27; : foodDetail[2].quality === 1 ? &#x27;合格&#x27; : &#x27;不合格&#x27; &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item v-if=&quot;foodDetail[2] &amp;&amp; user === 3&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;发货单位&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[2].from &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-timeline-item v-if=&quot;foodDetail[2] &amp;&amp; user === 3&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;div&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;收货单位&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;&#123;&#123; foodDetail[2].to &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">              &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-timeline-item&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-timeline&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 时间格式转化</span></span><br><span class="line">    <span class="title function_">dateTime</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">dateTime</span>(val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加蔬菜组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddVegetable</span> = &#123;</span><br><span class="line">  <span class="comment">// 溯源详情组件注册</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">TraceDetail</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">traceName</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 收货单位</span></span><br><span class="line">        <span class="attr">quality</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 质检情况</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">formLabelWidth</span>: <span class="string">&#x27;180px&#x27;</span>, <span class="comment">// 弹窗宽度</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接受传入的食品详情、可视化、用户信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;dialogFormVisible&#x27;</span>, <span class="string">&#x27;food&#x27;</span>, <span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>:<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;el-dialog title=&quot;添加食品信息&quot; :visible.sync=&quot;dialogFormVisible&quot; :show-close=&quot;false&quot; width=&quot;40%&quot; :center=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;el-form :model=&quot;form&quot; ref=&quot;form&quot; label-position=&quot;left&quot; :label-width=&quot;formLabelWidth&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item </span></span><br><span class="line"><span class="string">            label=&quot;质检情况&quot;</span></span><br><span class="line"><span class="string">            prop=&quot;quality&quot;</span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请选择质检情况&#x27;, trigger: &#x27;change&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;el-radio-group v-model=&quot;form.quality&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;0&quot;&gt;优质&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;1&quot;&gt;合格&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;2&quot;&gt;不合格&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-radio-group&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item</span></span><br><span class="line"><span class="string">            label=&quot;收货单位(本单位)&quot;</span></span><br><span class="line"><span class="string">            prop=&quot;traceName&quot;</span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请输入收货单位&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;el-input v-model=&quot;form.traceName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/el-form&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">          &lt;el-button @click=&quot;$emit(&#x27;popup&#x27;, false)&quot;&gt;取 消&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(&#x27;form&#x27;)&quot;&gt;确 定&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;el-divider&gt;&lt;/el-divider&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;!-- 食品详情信息 --&gt;</span></span><br><span class="line"><span class="string">        &lt;TraceDetail :food-detail=&quot;food&quot; :user=&quot;user&quot; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-dialog&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 处理添加蔬菜提交， $emit 到 父组件处理</span></span><br><span class="line">    <span class="title function_">submitForm</span>(<span class="params">formName</span>) &#123;</span><br><span class="line">      <span class="comment">// 参数校验</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$emit(<span class="string">&#x27;confirmPopup&#x27;</span>, <span class="variable language_">this</span>.<span class="property">form</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mixin， 这里主要处理中间商和超市的耦合业务</span></span><br><span class="line"><span class="keyword">const</span> mixin = &#123;</span><br><span class="line">  <span class="comment">// 注册添加蔬菜信息、食品详情子组件</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">AddVegetable</span>,</span><br><span class="line">    <span class="title class_">FoodDetail</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接受传入的分页信息</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;currPage&#x27;</span>, <span class="string">&#x27;pageSize&#x27;</span>],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">popup</span>: <span class="literal">false</span>, <span class="comment">// 控制添加蔬菜信息弹窗</span></span><br><span class="line">      <span class="attr">traceNumber</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 溯源码</span></span><br><span class="line">      <span class="attr">foodDetail</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 溯源食品信息</span></span><br><span class="line">      <span class="attr">foodList</span>: [], <span class="comment">// 食品信息列表</span></span><br><span class="line">      <span class="attr">popoverData</span>: &#123;&#125;, <span class="comment">// 弹窗食品信息数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 当前页的数据渲染</span></span><br><span class="line">    <span class="title function_">renderList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">foodList</span>.<span class="title function_">slice</span>((<span class="variable language_">this</span>.<span class="property">currPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>, <span class="variable language_">this</span>.<span class="property">currPage</span> * <span class="variable language_">this</span>.<span class="property">pageSize</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;el-input</span></span><br><span class="line"><span class="string">        placeholder=&quot;请输入溯源码&quot;</span></span><br><span class="line"><span class="string">        v-model.number=&quot;traceNumber&quot;</span></span><br><span class="line"><span class="string">        clearable&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-input&gt; </span></span><br><span class="line"><span class="string">      &lt;el-button type=&quot;primary&quot; @click=&quot;addVegetable&quot;&gt;添加食品信息&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">      &lt;el-button type=&quot;danger&quot; @click=&quot;$emit(&#x27;logout&#x27;, false)&quot; class=&quot;button-logout&quot;&gt;退出&lt;/el-button&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 食品流转信息列表 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-table</span></span><br><span class="line"><span class="string">        :data=&quot;renderList&quot;</span></span><br><span class="line"><span class="string">        style=&quot;width: 100%&quot;</span></span><br><span class="line"><span class="string">        :default-sort = &quot;&#123;prop: &#x27;date&#x27;, order: &#x27;descending&#x27;&#125;&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;traceNumber&quot;</span></span><br><span class="line"><span class="string">          label=&quot;溯源码&quot;   </span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">          &lt;template slot-scope=&quot;scope&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;!-- 鼠标点击食品细节弹窗信息 --&gt;</span></span><br><span class="line"><span class="string">        &lt;el-popover trigger=&quot;click&quot; placement=&quot;top&quot; @show=&quot;handlePopover(scope.row)&quot; :width=&quot;400&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;FoodDetail :food=&quot;popoverData&quot;  /&gt;</span></span><br><span class="line"><span class="string">          &lt;div slot=&quot;reference&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;span style=&quot;color: blue; cursor: pointer;&quot;&gt;&#123;&#123; scope.row.traceNumber &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/el-popover&gt;</span></span><br><span class="line"><span class="string">      &lt;/template&gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;name&quot;</span></span><br><span class="line"><span class="string">          label=&quot;食品名称&quot;</span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">        prop=&quot;date&quot;</span></span><br><span class="line"><span class="string">        label=&quot;上架时间&quot;</span></span><br><span class="line"><span class="string">        sortable</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;quality&quot;</span></span><br><span class="line"><span class="string">          label=&quot;质检情况&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;from&quot;</span></span><br><span class="line"><span class="string">          label=&quot;发货单位&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;to&quot;</span></span><br><span class="line"><span class="string">          label=&quot;收获单位&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-table&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 添加蔬菜信息组件 --&gt;</span></span><br><span class="line"><span class="string">      &lt;AddVegetable :dialogFormVisible=&quot;popup&quot; :user=&quot;user&quot; :food=&quot;foodDetail&quot;  @popup=&quot;handlePopup&quot; @confirmPopup=&quot;formSubmit&quot; /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 数据获取，根据 user 用户类型来分别获取中间商和超市的数据</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> pathname = <span class="variable language_">this</span>.<span class="property">user</span> === <span class="number">1</span> ? <span class="string">&#x27;distributing&#x27;</span> : <span class="string">&#x27;retailing&#x27;</span>;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/<span class="subst">$&#123;pathname&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">foodList</span> = ret.<span class="property">data</span></span><br><span class="line">          .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> quality = item.<span class="property">quality</span> === <span class="number">0</span> ? <span class="string">&#x27;优质&#x27;</span> : item.<span class="property">quality</span> === <span class="number">1</span> ? <span class="string">&#x27;合格&#x27;</span> : <span class="string">&#x27;不合格&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> (&#123;</span><br><span class="line">              ...item,</span><br><span class="line">              <span class="attr">date</span>: <span class="title function_">dateTime</span>(item.<span class="property">timestamp</span>),</span><br><span class="line">              quality,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">reverse</span>();</span><br><span class="line">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;total&#x27;</span>, <span class="variable language_">this</span>.<span class="property">foodList</span>.<span class="property">length</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 表格中食品详情弹窗</span></span><br><span class="line">    <span class="title function_">handlePopover</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="comment">// 中间商已有的信息足有支持显示，不需要进行额外 http 请求</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">popoverData</span> = data;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 超市则需要额外发送 http　请求获取更多细节</span></span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/food?traceNumber=<span class="subst">$&#123;data.traceNumber&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">popoverData</span> = ret.<span class="property">data</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 处理添加蔬菜信息</span></span><br><span class="line">    <span class="title function_">addVegetable</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">traceNumber</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入溯源码&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/trace?traceNumber=<span class="subst">$&#123;<span class="variable language_">this</span>.traceNumber&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">foodDetail</span> = ret.<span class="property">data</span> || []</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">popup</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加蔬菜信息弹窗</span></span><br><span class="line">    <span class="title function_">handlePopup</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">popup</span> = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加蔬菜信息提交，根据 user 进行不同的请求</span></span><br><span class="line">    <span class="title function_">formSubmit</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> pathname = <span class="variable language_">this</span>.<span class="property">user</span> === <span class="number">1</span> ? <span class="string">&#x27;adddistribution&#x27;</span> : <span class="string">&#x27;addretail&#x27;</span>;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/<span class="subst">$&#123;pathname&#125;</span>`</span>, </span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          ...val,</span><br><span class="line">          <span class="attr">quality</span>: <span class="built_in">parseInt</span>(val.<span class="property">quality</span>),</span><br><span class="line">          <span class="attr">traceNumber</span>: <span class="variable language_">this</span>.<span class="property">foodDetail</span>[<span class="number">0</span>].<span class="property">traceNumber</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ret.<span class="property">data</span>.<span class="property">ret</span> !== <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;提交失败&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;提交成功&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">popup</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建蔬菜组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CreateVegetable</span> = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">foodName</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 食品名称</span></span><br><span class="line">        <span class="attr">traceName</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 生产商名称</span></span><br><span class="line">        <span class="attr">traceNumber</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 溯源码</span></span><br><span class="line">        <span class="attr">quality</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 质检情况</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">formLabelWidth</span>: <span class="string">&#x27;120px&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 接受传入的可视化参数</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;dialogFormVisible&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>:<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;el-dialog title=&quot;新建食品&quot; :visible.sync=&quot;dialogFormVisible&quot; :show-close=&quot;false&quot; width=&quot;35%&quot; :center=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;el-form :model=&quot;form&quot; ref=&quot;form&quot; label-position=&quot;left&quot; :label-width=&quot;formLabelWidth&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item </span></span><br><span class="line"><span class="string">            label=&quot;溯源码&quot; </span></span><br><span class="line"><span class="string">            prop=&quot;traceNumber&quot; </span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请输入溯源码&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot; </span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            &lt;el-input v-model.number=&quot;form.traceNumber&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item </span></span><br><span class="line"><span class="string">            label=&quot;食品名称&quot; </span></span><br><span class="line"><span class="string">            prop=&quot;foodName&quot; </span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请输入食品名称&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot; </span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            &lt;el-input v-model=&quot;form.foodName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item </span></span><br><span class="line"><span class="string">            label=&quot;生产商&quot; </span></span><br><span class="line"><span class="string">            prop=&quot;traceName&quot; </span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请输入生产商&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot; </span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            &lt;el-input v-model=&quot;form.traceName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form-item </span></span><br><span class="line"><span class="string">            label=&quot;质检情况&quot;</span></span><br><span class="line"><span class="string">            prop=&quot;quality&quot;</span></span><br><span class="line"><span class="string">            :rules=&quot;[</span></span><br><span class="line"><span class="string">              &#123; required: true, message: &#x27;请选择质检情况&#x27;, trigger: &#x27;change&#x27; &#125;</span></span><br><span class="line"><span class="string">            ]&quot; </span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            &lt;el-radio-group v-model=&quot;form.quality&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;0&quot;&gt;优质&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;1&quot;&gt;合格&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">              &lt;el-radio label=&quot;2&quot;&gt;不合格&lt;/el-radio&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-radio-group&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">        &lt;/el-form&gt;</span></span><br><span class="line"><span class="string">        &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;el-button @click=&quot;$emit(&#x27;popup&#x27;, false)&quot;&gt;取 消&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(&#x27;form&#x27;)&quot;&gt;确 定&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-dialog&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 提交信息</span></span><br><span class="line">    <span class="title function_">submitForm</span>(<span class="params">formName</span>) &#123;</span><br><span class="line">      <span class="comment">// 参数校验</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">validate</span>(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.$emit(<span class="string">&#x27;confirmPopup&#x27;</span>, <span class="variable language_">this</span>.<span class="property">form</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="login-js"><a href="#login-js" class="headerlink" title="login.js"></a>login.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 登录组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Login</span> = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 用户身份</span></span><br><span class="line">      <span class="attr">users</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;生产者&quot;</span>,</span><br><span class="line">          <span class="attr">userName</span>: <span class="string">&#x27;producer&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="title class_">Farm</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;分销商&quot;</span>,</span><br><span class="line">          <span class="attr">userName</span>: <span class="string">&#x27;distributor&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="title class_">Agent</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;超市&quot;</span>,</span><br><span class="line">          <span class="attr">userName</span>: <span class="string">&#x27;retailer&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="title class_">Mall</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;消费者&quot;</span>,</span><br><span class="line">          <span class="attr">userName</span>: <span class="string">&#x27;consumer&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="title class_">Consumer</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">currentUser</span>: <span class="literal">null</span>, <span class="comment">// 当前用户</span></span><br><span class="line">      <span class="attr">address</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 角色地址</span></span><br><span class="line">      <span class="attr">countdown</span>: <span class="number">5</span>, <span class="comment">// 倒计时时间</span></span><br><span class="line">      <span class="attr">loginItem</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 登录用户信息</span></span><br><span class="line">      <span class="attr">timer</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 处理倒计时的定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;login&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 角色选择 --&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 v-if=&quot;currentUser === null&quot;&gt;请选择您的角色&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;el-row :gutter=&quot;80&quot;  v-if=&quot;currentUser === null&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;el-col :span=&quot;6&quot; v-for=&quot;(item,index) in users&quot; :key=&quot;index&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;div @click=&quot;handleClick(item)&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/el-col&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-row&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 角色登录 --&gt;</span></span><br><span class="line"><span class="string">      &lt;div v-else class=&quot;is-login&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;登录中......(倒计时：&#123;&#123; countdown &#125;&#125; 秒)&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;角色: </span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123;currentUser&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;!-- 非消费者则显示角色地址 --&gt;</span></span><br><span class="line"><span class="string">        &lt;div v-if=&quot;currentUser !== &#x27;消费者&#x27;&quot;&gt;角色地址:</span></span><br><span class="line"><span class="string">          &lt;span&gt;&#123;&#123;address&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;!-- 直接登录按钮 --&gt;</span></span><br><span class="line"><span class="string">        &lt;el-button type=&quot;primary&quot; @click=&quot;clearTimer&quot;&gt;直接登录&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 登录时有个5秒的倒计时，这里是在点击直接登录时，清楚倒计时，直接跳到相关页面</span></span><br><span class="line">    <span class="title function_">clearTimer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">component</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">component</span>, </span><br><span class="line">        <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">loginItem</span>.<span class="property">name</span>, </span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 倒计时</span></span><br><span class="line">    <span class="title function_">countdownInterval</span>(<span class="params">&#123; component, name: user &#125;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">countdown</span> &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">clearTimer</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">countdown</span> -= <span class="number">1</span>;</span><br><span class="line">      &#125;,  <span class="number">1000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 点击用户登录，获取用户地址</span></span><br><span class="line">    <span class="title function_">handleClick</span>(<span class="params">item</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">loginItem</span> = item;</span><br><span class="line">      <span class="comment">// 处理消费者角色，其他三个角色都有一个角色地址</span></span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">userName</span> !== <span class="string">&#x27;consumer&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">axios</span>(&#123;</span><br><span class="line">          <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/userinfo?userName=<span class="subst">$&#123;item.userName&#125;</span>`</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">address</span> = ret.<span class="property">data</span>.<span class="property">address</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentUser</span> = item.<span class="property">name</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">countdownInterval</span>(item);</span><br><span class="line">        &#125;) </span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentUser</span> = item.<span class="property">name</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">countdownInterval</span>(item);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 农场组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Farm</span> = &#123;</span><br><span class="line">  <span class="comment">// 接受分页属性，用来控制翻页</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;currPage&#x27;</span>, <span class="string">&#x27;pageSize&#x27;</span>],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">popup</span>: <span class="literal">false</span>, <span class="comment">// 创建蔬菜弹窗</span></span><br><span class="line">      <span class="attr">foodList</span>: [], <span class="comment">// 食品信息</span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 当前页渲染数据</span></span><br><span class="line">    <span class="title function_">renderList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">foodList</span>.<span class="title function_">slice</span>((<span class="variable language_">this</span>.<span class="property">currPage</span> - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageSize</span>, <span class="variable language_">this</span>.<span class="property">currPage</span> * <span class="variable language_">this</span>.<span class="property">pageSize</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 注册创建蔬菜子组件</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">CreateVegetable</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 创建蔬菜按钮 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-button type=&quot;primary&quot; @click=&quot;popup = true;&quot;&gt;新建食品&lt;/el-button&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 退出按钮 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-button type=&quot;danger&quot; @click=&quot;$emit(&#x27;logout&#x27;, false)&quot; class=&quot;button-logout&quot;&gt;退出&lt;/el-button&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 食品信息列表 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-table</span></span><br><span class="line"><span class="string">        :data=&quot;renderList&quot;</span></span><br><span class="line"><span class="string">        style=&quot;width: 100%&quot;</span></span><br><span class="line"><span class="string">        :default-sort = &quot;&#123;prop: &#x27;date&#x27;, order: &#x27;descending&#x27;&#125;&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;traceNumber&quot;</span></span><br><span class="line"><span class="string">          label=&quot;溯源码&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;foodName&quot;</span></span><br><span class="line"><span class="string">          label=&quot;食品名称&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;traceName&quot;</span></span><br><span class="line"><span class="string">          label=&quot;生产商&quot;</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">        &lt;el-table-column</span></span><br><span class="line"><span class="string">          prop=&quot;date&quot;</span></span><br><span class="line"><span class="string">          label=&quot;生产时间&quot;</span></span><br><span class="line"><span class="string">          sortable</span></span><br><span class="line"><span class="string">        &gt;</span></span><br><span class="line"><span class="string">        &lt;/el-table-column&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-table&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 创建蔬菜子组件 --&gt;</span></span><br><span class="line"><span class="string">      &lt;CreateVegetable :dialogFormVisible=&quot;popup&quot; @popup=&quot;handlePopup&quot; @confirmPopup=&quot;formSubmit&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载时获取农场数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 处理数据请求</span></span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/producing`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 对数据进行处理</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">foodList</span> = ret.<span class="property">data</span></span><br><span class="line">          .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">            ...item,</span><br><span class="line">            <span class="attr">date</span>: <span class="title function_">dateTime</span>(item.<span class="property">timestamp</span>),</span><br><span class="line">            <span class="attr">traceNumber</span>: item.<span class="property">traceNumber</span>,</span><br><span class="line">            <span class="attr">traceName</span>: item.<span class="property">from</span>,</span><br><span class="line">            <span class="attr">foodName</span>: item.<span class="property">name</span></span><br><span class="line">          &#125;))</span><br><span class="line">          .<span class="title function_">reverse</span>();     </span><br><span class="line">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;total&#x27;</span>, <span class="variable language_">this</span>.<span class="property">foodList</span>.<span class="property">length</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加蔬菜弹窗</span></span><br><span class="line">    <span class="title function_">handlePopup</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">popup</span> = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加蔬菜提交</span></span><br><span class="line">    <span class="title function_">formSubmit</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/produce`</span>, </span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          ...val,</span><br><span class="line">          <span class="attr">quality</span>: <span class="built_in">parseInt</span>(val.<span class="property">quality</span>),</span><br><span class="line">          <span class="attr">user</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ret.<span class="property">data</span>.<span class="property">ret</span> !== <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// 已有溯源码校验</span></span><br><span class="line">          <span class="keyword">if</span> (ret.<span class="property">data</span>.<span class="property">ret</span> === <span class="number">0</span> &amp;&amp; ret.<span class="property">data</span>.<span class="property">msg</span> === <span class="string">&#x27;traceNumber already exist&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;该溯源码已存在，请重新创建&#x27;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">              <span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;提交失败&#x27;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">              <span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;提交成功&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">center</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 提交成功后重新获取数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">popup</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间商组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Agent</span> = &#123;</span><br><span class="line">  <span class="comment">// 和超市的职能差不多，放在 mixin 里面</span></span><br><span class="line">  <span class="attr">mixins</span>: [mixin],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="number">1</span>, <span class="comment">// user: 1 为中间商</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseURL=<span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 超市组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Mall</span> = &#123;</span><br><span class="line">  <span class="comment">// 和中间商的职能差不多，放在 mixin 里面</span></span><br><span class="line">  <span class="attr">mixins</span>: [mixin],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="number">2</span>, <span class="comment">// user: 2 为超市</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 消费者组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Consumer</span> = &#123;</span><br><span class="line">  <span class="comment">// 溯源详情子组件注册</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">TraceDetail</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">traceNumber</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 输入的溯源码</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">foodDetail</span>: [</span><br><span class="line">        <span class="string">&quot;&quot;</span></span><br><span class="line">      ], <span class="comment">// 溯源详细信息</span></span><br><span class="line">      <span class="attr">onSearch</span>: <span class="literal">false</span>, <span class="comment">// 搜索情况</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>:<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;el-row style=&quot;height: 100%;&quot; class=&quot;consumer&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 左边为溯源查询 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-col :span=&quot;7&quot; style=&quot;height: 100%;&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;grid-content bg-purple&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;el-form :model=&quot;form&quot; ref=&quot;form&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h4&gt;溯源码搜索&lt;/h4&gt;</span></span><br><span class="line"><span class="string">            &lt;el-divider&gt;&lt;/el-divider&gt;</span></span><br><span class="line"><span class="string">            &lt;el-form-item </span></span><br><span class="line"><span class="string">              label=&quot;请输入您想要查询的溯源码&quot; </span></span><br><span class="line"><span class="string">              prop=&quot;traceNumber&quot; </span></span><br><span class="line"><span class="string">            &gt;</span></span><br><span class="line"><span class="string">              &lt;el-input v-model.number=&quot;form.traceNumber&quot; type=&quot;textarea&quot; :rows=&quot;3&quot; autocomplete=&quot;off&quot; @clear=&quot;onSearch = false;&quot;&gt;&lt;/el-input&gt;</span></span><br><span class="line"><span class="string">            &lt;/el-form-item&gt;</span></span><br><span class="line"><span class="string">            &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt;查询&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-form&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-col&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 右边为溯源查询结果 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-col :span=&quot;16&quot; style=&quot;width:820px&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;grid-content bg-purple-light&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;div v-if =&quot;!onSearch&quot; class=&quot;consumer-tip&quot;&gt;请在左侧查询栏中输入溯源码进行查询&lt;/div&gt;  </span></span><br><span class="line"><span class="string">          &lt;div v-if =&quot;onSearch &amp;&amp; foodDetail.length === 0&quot; class=&quot;consumer-tip&quot;&gt;该溯源码无对应信息，请确认后重新查询&lt;/div&gt;  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;!-- 溯源查询成功后才展示 --&gt;</span></span><br><span class="line"><span class="string">          &lt;div v-if =&quot;onSearch &amp;&amp; foodDetail.length &gt; 0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 溯源详情组件， user: 3 为消费者 --&gt;        </span></span><br><span class="line"><span class="string">            &lt;TraceDetail :food-detail=&quot;foodDetail&quot; :user=&quot;3&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;  </span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-col&gt;</span></span><br><span class="line"><span class="string">      &lt;el-col :span=&quot;1&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;!--退出按钮 --&gt;</span></span><br><span class="line"><span class="string">        &lt;el-button type=&quot;danger&quot; @click=&quot;$emit(&#x27;logout&#x27;, false)&quot; class=&quot;button-logout&quot; style=&quot;margin-right:80px&quot;&gt;退出&lt;/el-button&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-col&gt;</span></span><br><span class="line"><span class="string">    &lt;/el-row&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 处理按溯源码查询</span></span><br><span class="line">    <span class="title function_">onSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">traceNumber</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;请输入溯源码&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onSearch</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;baseURL&#125;</span>/trace?traceNumber=<span class="subst">$&#123;<span class="variable language_">this</span>.form.traceNumber&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">ret</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">foodDetail</span> = ret.<span class="property">data</span> || []</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="comment">// 注册 Header、Login 子组件</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">Header</span>,</span><br><span class="line">    <span class="title class_">Login</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 实例绑定的元素</span></span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">currPage</span>: <span class="number">1</span>, <span class="comment">// 当前页</span></span><br><span class="line">    <span class="attr">pageSize</span>: <span class="number">10</span>, <span class="comment">// 每页显示数据</span></span><br><span class="line">    <span class="attr">total</span>: <span class="number">0</span>, <span class="comment">// 总数据</span></span><br><span class="line">    <span class="attr">showComponent</span>: <span class="title class_">Farm</span>, <span class="comment">// 当前展示的动态组件</span></span><br><span class="line">    <span class="attr">login</span>: <span class="literal">false</span>, <span class="comment">// 登录状态</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 当前用户</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;el-container&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 头部导航组件 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-header class=&quot;header&quot;&gt;&lt;Header :user=&quot;user&quot; :login=&quot;login&quot; @logout=&quot;(val) =&gt; &#123;this.login = val;&#125;&quot; /&gt;&lt;/el-header&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;!-- 主要内容组件 --&gt;</span></span><br><span class="line"><span class="string">      &lt;el-container&gt;</span></span><br><span class="line"><span class="string">        &lt;el-main&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;!-- 登录组件 --&gt;</span></span><br><span class="line"><span class="string">          &lt;Login v-if=&quot;!login&quot; @login=&quot;(val) =&gt; &#123;this.login = true; this.showComponent = val.component; this.user = val.user;&#125;&quot; /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;!-- 动态组件，根据 showComponent 动态渲染当前用户 --&gt;</span></span><br><span class="line"><span class="string">          &lt;component v-else :is=&quot;showComponent&quot;</span></span><br><span class="line"><span class="string">            @logout=&quot;(val) =&gt; &#123;this.login = val;&#125;&quot; </span></span><br><span class="line"><span class="string">            @total=&quot;(val) =&gt; &#123;this.total = val;&#125;&quot;</span></span><br><span class="line"><span class="string">            :curr-page.sync=&quot;currPage&quot; :page-size.sync=&quot;pageSize&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;/component&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;!-- 分页组件 --&gt;</span></span><br><span class="line"><span class="string">          &lt;el-pagination </span></span><br><span class="line"><span class="string">            style=&quot;text-align: center; margin-top: 10px;&quot;</span></span><br><span class="line"><span class="string">            v-if=&quot;login &amp;&amp; showComponent.name !== &#x27;Consumer&#x27;&quot;</span></span><br><span class="line"><span class="string">            background</span></span><br><span class="line"><span class="string">            :hide-on-single-page=&quot;false&quot;</span></span><br><span class="line"><span class="string">            @size-change=&quot;handleSizeChange&quot;</span></span><br><span class="line"><span class="string">            @current-change=&quot;handleCurrentChange&quot;</span></span><br><span class="line"><span class="string">            :current-page.sync=&quot;currPage&quot;</span></span><br><span class="line"><span class="string">            :page-sizes=&quot;[10, 20, 50]&quot;</span></span><br><span class="line"><span class="string">            :page-size.sync=&quot;pageSize&quot;</span></span><br><span class="line"><span class="string">            layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span></span><br><span class="line"><span class="string">            :total=&quot;total&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;/el-pagination&gt;</span></span><br><span class="line"><span class="string">        &lt;/el-main&gt;</span></span><br><span class="line"><span class="string">      &lt;/el-container&gt;</span></span><br><span class="line"><span class="string">    &lt;/el-container&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 处理每页数据渲染数</span></span><br><span class="line">    <span class="title function_">handleSizeChange</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pageSize</span> = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 处理翻页</span></span><br><span class="line">    <span class="title function_">handleCurrentChange</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currPage</span> = val;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/images/favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/lib/element.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/style/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>1111122222<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入组件库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../static/lib/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../static/lib/element.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../static/lib/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引入 vue 实例及子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../static/src/pages/components.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../static/src/pages/login.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../static/src/pages/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../static/src/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端："><a href="#后端：" class="headerlink" title="后端："></a>后端：</h3><h4 id="conf-properties"><a href="#conf-properties" class="headerlink" title="conf.properties"></a>conf.properties</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#WeBASE-Front</span><br><span class="line">URL=http://192.168.40.130:5002/WeBASE-Front/trans/handle</span><br><span class="line">#不同的环境下，需要更改</span><br><span class="line">#合约地址</span><br><span class="line">CONTRACT_ADDRESS=0xece985f2cb554187881abd950a0415a3c72872f3</span><br><span class="line">#生产商用户地址</span><br><span class="line">PRODUCER_ADDRESS=0xbed9bf3f3cc5fd0aa24deb6a36139615f685d8ac</span><br><span class="line">#中间商用户地址</span><br><span class="line">DISTRIBUTOR_ADDRESS=0x13690e8bd64e3ef33afc5d568770ae335ddb6c03</span><br><span class="line">#零售商用户地址</span><br><span class="line">RETAILER_ADDRESS=0x7eef44f6a6f63b4530d5ebcc6b6a73a903fe4e22</span><br></pre></td></tr></table></figure>

<h4 id="IndexController-java"><a href="#IndexController-java" class="headerlink" title="IndexController.java"></a>IndexController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zgxt.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.JSONToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.ZoneId;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="comment">//填写WeBASE-Front地址，用于后续交互</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String URL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">CONTRACT_NAME</span> <span class="operator">=</span> <span class="string">&quot;Trace&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String CONTRACT_ADDRESS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONTRACT_ABI</span> <span class="operator">=</span> <span class="string">&quot;[&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;traceNumber\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;name\&quot;:\&quot;getFood\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint8\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;traceNumber\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;name\&quot;:\&quot;getTraceInfo\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256[]\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string[]\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address[]\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint8[]\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;name\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;traceNumber\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;traceName\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;quality\&quot;,\&quot;type\&quot;:\&quot;uint8\&quot;&#125;],\&quot;name\&quot;:\&quot;newFood\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;traceNumber\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;traceName\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;quality\&quot;,\&quot;type\&quot;:\&quot;uint8\&quot;&#125;],\&quot;name\&quot;:\&quot;addTraceInfoByDistributor\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;isRetailer\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[],\&quot;name\&quot;:\&quot;renounceDistributor\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[],\&quot;name\&quot;:\&quot;getAllFood\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256[]\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;addDistributor\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;addRetailer\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;isDistributor\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;traceNumber\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;traceName\&quot;,\&quot;type\&quot;:\&quot;string\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;quality\&quot;,\&quot;type\&quot;:\&quot;uint8\&quot;&#125;],\&quot;name\&quot;:\&quot;addTraceInfoByRetailer\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[],\&quot;name\&quot;:\&quot;renounceRetailer\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;addProducer\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;isProducer\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[],\&quot;name\&quot;:\&quot;renounceProducer\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;producer\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;distributor\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;retailer\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;constructor\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;RetailerAdded\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;RetailerRemoved\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;DistributorAdded\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;DistributorRemoved\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;ProducerAdded\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:true,\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;ProducerRemoved\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//填写用户地址信息</span></span><br><span class="line">    <span class="comment">//192.168.1.103</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String PRODUCER_ADDRESS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String DISTRIBUTOR_ADDRESS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String RETAILER_ADDRESS;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndexController</span><span class="params">()</span> &#123;</span><br><span class="line">        loadConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//读取配置文件</span></span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;conf.properties&quot;</span>);</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            properties.load(fis);</span><br><span class="line">            fis.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取配置文件数据</span></span><br><span class="line">            URL = properties.getProperty(<span class="string">&quot;URL&quot;</span>);</span><br><span class="line">            System.out.println(URL);</span><br><span class="line">            CONTRACT_ADDRESS = properties.getProperty(<span class="string">&quot;CONTRACT_ADDRESS&quot;</span>);</span><br><span class="line">            System.out.println(CONTRACT_ADDRESS);</span><br><span class="line">            PRODUCER_ADDRESS = properties.getProperty(<span class="string">&quot;PRODUCER_ADDRESS&quot;</span>);</span><br><span class="line">            System.out.println(PRODUCER_ADDRESS);</span><br><span class="line">            DISTRIBUTOR_ADDRESS = properties.getProperty(<span class="string">&quot;DISTRIBUTOR_ADDRESS&quot;</span>);</span><br><span class="line">            System.out.println(DISTRIBUTOR_ADDRESS);</span><br><span class="line">            RETAILER_ADDRESS = properties.getProperty(<span class="string">&quot;RETAILER_ADDRESS&quot;</span>);</span><br><span class="line">            System.out.println(RETAILER_ADDRESS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户地址</span></span><br><span class="line"><span class="comment">     * userinfo: 用户角色（producer=食品生产商 distributor=中间商 retailer=超市）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: 角色对应用户地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/userinfo&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">(String userName)</span>&#123;</span><br><span class="line">        <span class="comment">//声明返回对象</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回各个用户的地址</span></span><br><span class="line">        <span class="keyword">if</span> (userName.equals(<span class="string">&quot;producer&quot;</span>))&#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;address&quot;</span>, PRODUCER_ADDRESS);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (userName.equals(<span class="string">&quot;distributor&quot;</span>))&#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;address&quot;</span>, DISTRIBUTOR_ADDRESS);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (userName.equals(<span class="string">&quot;retailer&quot;</span>))&#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;address&quot;</span>, RETAILER_ADDRESS);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;user not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _outPut.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加食品生产信息</span></span><br><span class="line"><span class="comment">     * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * foodName: 食物名称</span></span><br><span class="line"><span class="comment">     * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">     * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>：添加食品生产信息结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/produce&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">produce</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明返回对象</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生产商生产食品</span></span><br><span class="line">        <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">trace_number</span> <span class="operator">=</span> (<span class="type">int</span>)jsonParam.get(<span class="string">&quot;traceNumber&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">food_name</span> <span class="operator">=</span> (String)jsonParam.get(<span class="string">&quot;foodName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> (String)jsonParam.get(<span class="string">&quot;traceName&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> (<span class="type">int</span>)jsonParam.get(<span class="string">&quot;quality&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[\&quot;&quot;</span>+food_name+<span class="string">&quot;\&quot;,&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,PRODUCER_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;newFood&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">1</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">0</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中间商添加食品流转信息</span></span><br><span class="line"><span class="comment">     * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">     * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>：中间商添加食品流转信息结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(path=&quot;adddistribution&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">add_trace_by_distrubutor</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line">        <span class="comment">//声明返回对象</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">trace_number</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceNumber&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceName&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> (<span class="type">int</span>) jsonParam.get(<span class="string">&quot;quality&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,DISTRIBUTOR_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;addTraceInfoByDistributor&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">1</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">0</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 超市添加食品流转信息</span></span><br><span class="line"><span class="comment">     * traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * traceName: 用户名，食品流转过程各个阶段的用户名</span></span><br><span class="line"><span class="comment">     * quality: 当前食品质量（0=优质 1=合格 2=不合格）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonParam</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 超市添加食品流转信息结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@PostMapping(path=&quot;/addretail&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">add_trace_by_retailer</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject jsonParam)</span> &#123;</span><br><span class="line">        <span class="comment">//声明返回对象</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(jsonParam == <span class="literal">null</span>)&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid parameter&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">trace_number</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceNumber&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">trace_name</span> <span class="operator">=</span> (String) jsonParam.get(<span class="string">&quot;traceName&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">quality</span> <span class="operator">=</span> (<span class="type">int</span>) jsonParam.get(<span class="string">&quot;quality&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+trace_number+<span class="string">&quot;,\&quot;&quot;</span>+trace_name+<span class="string">&quot;\&quot;,&quot;</span>+quality+<span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,RETAILER_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;addTraceInfoByRetailer&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseObject(responseStr);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> responseJsonObj.getString(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (msg.equals(<span class="string">&quot;Success&quot;</span>))&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">1</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;ret&quot;</span>,<span class="number">0</span>);</span><br><span class="line">            _outPutObj.put(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _outPutObj.toJSONString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     # 获取所有食物信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有食品信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/foodlist&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getlist</span><span class="params">()</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list</span> <span class="operator">=</span> get_food_list();</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list2</span> <span class="operator">=</span> num_list.getJSONArray(<span class="number">0</span>);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">resList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_list2.size();i++)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">food</span> <span class="operator">=</span> get_food(num_list2.get(i).toString());</span><br><span class="line">            resList.add(food);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resList.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/trace&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(traceNumber) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid params&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _outPut.toJSONString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">List</span> <span class="variable">res</span> <span class="operator">=</span> get_trace(traceNumber);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(res);</span><br><span class="line">        <span class="keyword">return</span> o.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取某个食品的当前信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应食品的当前信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/food&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">food</span><span class="params">(String traceNumber)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(traceNumber) &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            _outPut.put(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;invalid parameter&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _outPut.toJSONString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> get_food(traceNumber);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有食品的最新溯源信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有食品的最新溯源信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/newtracelist&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_latest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list</span> <span class="operator">=</span> get_food_list();</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list2</span> <span class="operator">=</span> num_list.getJSONArray(<span class="number">0</span>);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">resList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_list2.size();i++)&#123;</span><br><span class="line">            <span class="type">List</span> <span class="variable">trace</span> <span class="operator">=</span> get_trace(num_list2.get(i).toString());</span><br><span class="line">            resList.add(trace.get(trace.size()-<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resList.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取位于生产商的的食物信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有位于生产商的食品信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/producing&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_producing</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list</span> <span class="operator">=</span> get_food_list();</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list2</span> <span class="operator">=</span> JSON.parseArray(num_list.get(<span class="number">0</span>).toString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">resList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_list2.size();i++)&#123;</span><br><span class="line">            <span class="type">JSONArray</span> <span class="variable">trace</span> <span class="operator">=</span> get_trace(num_list2.get(i).toString());</span><br><span class="line">            <span class="keyword">if</span>(trace.size() == <span class="number">1</span>)&#123;</span><br><span class="line">                resList.add(trace.get(<span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> resList.toJSONString();</span><br><span class="line">        <span class="keyword">return</span> resList.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取位于中间商的食物信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有位于中间商的食品信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/distributing&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_distributing</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list</span> <span class="operator">=</span> get_food_list();</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list2</span> <span class="operator">=</span> JSON.parseArray(num_list.get(<span class="number">0</span>).toString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">resList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_list2.size();i++)&#123;</span><br><span class="line">            <span class="type">List</span> <span class="variable">trace</span> <span class="operator">=</span> get_trace(num_list2.get(i).toString());</span><br><span class="line">            <span class="keyword">if</span>(trace.size() == <span class="number">2</span>)&#123;</span><br><span class="line">                resList.add(trace.get(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resList.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取位于超市的食物信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有位于超市的食品信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(path=&quot;/retailing&quot;, produces=MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_retailing</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">num_list</span> <span class="operator">=</span> get_food_list();</span><br><span class="line">        <span class="type">List</span> <span class="variable">num_list2</span> <span class="operator">=</span> JSONArray.parseArray(num_list.get(<span class="number">0</span>).toString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">resList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;num_list2.size();i++)&#123;</span><br><span class="line">            <span class="type">List</span> <span class="variable">trace</span> <span class="operator">=</span> get_trace(num_list2.get(i).toString());</span><br><span class="line">            <span class="keyword">if</span>(trace.size() == <span class="number">3</span>)&#123;</span><br><span class="line">                resList.add(trace.get(<span class="number">2</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resList.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * # 从链上获取所有食品信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有食品信息列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> JSONArray <span class="title function_">get_food_list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getAllFood&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">responseJsonObj</span> <span class="operator">=</span> JSON.parseArray(responseStr);</span><br><span class="line">        <span class="keyword">return</span> responseJsonObj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从链上获取某个食品的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> traceNumber: 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应食品的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">get_food</span><span class="params">(String traceNumber)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+traceNumber+<span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getFood&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">food</span>  <span class="operator">=</span> JSON.parseArray(responseStr);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _outPut.put(<span class="string">&quot;timestamp&quot;</span>, FormatTime(Long.parseLong(food.get(<span class="number">0</span>).toString())));</span><br><span class="line">        _outPut.put(<span class="string">&quot;produce&quot;</span>,food.get(<span class="number">1</span>));</span><br><span class="line">        _outPut.put(<span class="string">&quot;name&quot;</span>,food.get(<span class="number">2</span>));</span><br><span class="line">        _outPut.put(<span class="string">&quot;current&quot;</span>,food.get(<span class="number">3</span>));</span><br><span class="line">        _outPut.put(<span class="string">&quot;address&quot;</span>,food.get(<span class="number">4</span>));</span><br><span class="line">        _outPut.put(<span class="string">&quot;quality&quot;</span>,food.get(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _outPut.toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从链上获取某个食品的溯源信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> traceNumber 食品溯源id，食品溯源过程中的标识符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应食品的溯源信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> JSONArray <span class="title function_">get_trace</span><span class="params">(String traceNumber)</span>&#123;</span><br><span class="line">        <span class="comment">//获取食品基本信息</span></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">params</span> <span class="operator">=</span> JSONArray.parseArray(<span class="string">&quot;[&quot;</span>+traceNumber+<span class="string">&quot;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getFood&quot;</span>);</span><br><span class="line">        _jsonObj.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr</span> <span class="operator">=</span> httpPost(URL,_jsonObj.toJSONString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">food</span>  <span class="operator">=</span> JSON.parseArray(responseStr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取食品溯源信息</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">_jsonObj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;contractName&quot;</span>,CONTRACT_NAME);</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;contractAddress&quot;</span>,CONTRACT_ADDRESS);</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;contractAbi&quot;</span>,JSONArray.parseArray(CONTRACT_ABI));</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;funcName&quot;</span>,<span class="string">&quot;getTraceInfo&quot;</span>);</span><br><span class="line">        _jsonObj2.put(<span class="string">&quot;funcParam&quot;</span>,params);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseStr2</span> <span class="operator">=</span> httpPost(URL,_jsonObj2.toJSONString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">traceInfoList</span>  <span class="operator">=</span> JSON.parseArray(responseStr2);</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">time_list</span> <span class="operator">=</span> JSON.parseArray(traceInfoList.get(<span class="number">0</span>).toString());</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">name_list</span> <span class="operator">=</span> JSON.parseArray((String)traceInfoList.get(<span class="number">1</span>));</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">address_list</span> <span class="operator">=</span>JSON.parseArray((String)traceInfoList.get(<span class="number">2</span>));</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">quality_list</span> <span class="operator">=</span> JSON.parseArray((String)traceInfoList.get(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">_outPut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;time_list.size();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>, traceNumber);</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;name&quot;</span>,food.get(<span class="number">2</span>));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,FormatTime(Long.parseLong(food.get(<span class="number">0</span>).toString())));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>, FormatTime((Long) time_list.get(i)));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;from&quot;</span>,name_list.get(i));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;quality&quot;</span>,quality_list.get(i));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,address_list.get(i));</span><br><span class="line">                _outPut.add(_outPutObj);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">_outPutObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;traceNumber&quot;</span>,traceNumber);</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;name&quot;</span>,food.get(<span class="number">2</span>));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;produce_time&quot;</span>,FormatTime(Long.parseLong(food.get(<span class="number">0</span>).toString())));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;timestamp&quot;</span>,FormatTime((Long) time_list.get(i)));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;from&quot;</span>,name_list.get(i-<span class="number">1</span>));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;to&quot;</span>,name_list.get(i));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;quality&quot;</span>,quality_list.get(i));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;from_address&quot;</span>,address_list.get(i-<span class="number">1</span>));</span><br><span class="line">                _outPutObj.put(<span class="string">&quot;to_address&quot;</span>,address_list.get(i));</span><br><span class="line">                _outPut.add(_outPutObj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _outPut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理时间戳转换为格式化日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timestamp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">FormatTime</span><span class="params">(Long timestamp)</span>&#123;</span><br><span class="line">        <span class="comment">// 将时间戳转换为Instant对象</span></span><br><span class="line">        <span class="type">Instant</span> <span class="variable">instant</span> <span class="operator">=</span> Instant.ofEpochMilli(timestamp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Instant转换为LocalDateTime对象</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> LocalDateTime.ofInstant(instant, ZoneId.systemDefault());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个DateTimeFormatter对象，并指定日期格式</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dateTime.format(formatter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送 post 请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     请求地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsonStr Form表单json字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 请求结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">httpPost</span><span class="params">(String url, String jsonStr)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建httpClient</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="comment">// 创建post请求方式实例</span></span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line">        <span class="comment">// 设置请求头 发送的是json数据格式</span></span><br><span class="line">        httpPost.setHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数---设置消息实体 也就是携带的数据</span></span><br><span class="line">        <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonStr, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="comment">// 设置编码格式</span></span><br><span class="line">        entity.setContentEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 发送Json格式的数据请求</span></span><br><span class="line">        entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="comment">// 把请求消息实体塞进去</span></span><br><span class="line">        httpPost.setEntity(entity);</span><br><span class="line">        <span class="comment">// 执行http的post请求</span></span><br><span class="line">        CloseableHttpResponse httpResponse;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpResponse = httpClient.execute(httpPost);</span><br><span class="line">            result = EntityUtils.toString(httpResponse.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>区块链 套题一</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://www.azer.com/post/2025/01/03/区块链 套题一/">https://www.azer.com/post/2025/01/03/区块链 套题一/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>阿泽</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-01-03</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-01-04</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a><a class="post-meta__tags" href="/tags/solidity/">solidity</a></div><div class="post-share"><div class="social-share" data-image="/img/%E5%B0%81%E9%9D%A2/13.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/04/music/" title=""><img class="cover" src="/img/%E5%B0%81%E9%9D%A2/2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2"></div></div><div class="info-2"><div class="info-item-1"> </div></div></div></a><a class="pagination-related" href="/2025/01/03/docker-compose/" title="Docker 私有仓库"><img class="cover" src="/img/%E5%B0%81%E9%9D%A2/6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Docker 私有仓库</div></div><div class="info-2"><div class="info-item-1">Docker Compose一、安装Docker Compose123456# Compose目前已经完全支持Linux、Mac OS和Windows，在我们安装Compose之前，需要先安装Docker。下面我 们以编译好的二进制包方式安装在Linux系统中。 curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose# 设置文件可执行权限 chmod +x /usr/local/bin/docker-compose# 查看版本信息 docker-compose -version  二、卸载Docker Compose12# 二进制包方式安装的，删除二进制文件即可rm /usr/local/bin/docker-compose    三、 使用docker compose编排nginx+springboot项目 创建docker-compose目录  12mkdir...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/03/%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/" title="图书管理系统的需求文档"><img class="cover" src="/img/%E5%B0%81%E9%9D%A2/2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="info-item-2">图书管理系统的需求文档</div></div><div class="info-2"><div class="info-item-1">图书管理系统需求：​	采取控制台的方式去书写图书管理系统。 分析：管理员菜单：12345678===========管理员菜单=========Hello 哈哈哈, 欢迎使用图书管理系统!1. 查找图书2. 新增图书3. 删除图书4. 显示所有图书0. 退出系统=============================  普通用户菜单：12345678==========普通用户菜单=========Hello 哈哈哈, 欢迎使用图书管理系统!1. 查找图书2. 借阅图书3. 归还图书4. 显示图书0. 退出系统=============================  图书类​    属性：图书名，作者，图书类型，图书价格，是否租借 图书集合类​    属性：图书数组，图书总数 添加功能：​	键盘录入每一个图书信息并添加，需要满足以下要求；  书名唯一  删除功能：​	键盘录入要删除的图书书名，需要满足以下要求：  图书存在删除 图书不存在，需要提示不存在，并回到初始菜单  查询功能：​   ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">阿泽</div><div class="author-info-description">瞳孔和心跳的距离 在与你对视时清零</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Azer-97/Azer-97.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon faa-parent animated-hover" href="/assets/QRCode.jpg" target="_blank" title="微信"><vg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-weixin"></use></vg></a><a class="social-icon faa-parent animated-hover" href="https://res.abeim.cn/api/qq/?qq=1174008660" target="_blank" title="QQ"><vg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ"></use></vg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/220757832" target="_blank" title="B站"><vg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></vg></a><a class="social-icon faa-parent animated-hover" href="mailto:1174008660@qq.com" target="_blank" title="QQ邮箱"><vg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></vg></a><a class="social-icon faa-parent animated-hover" href="https://leetcode.cn/u/fomalhaut1998" target="_blank" title="力扣"><vg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-leetcode"></use></vg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如果你在使用中遇到问题，请到 Github Issues 进行反馈，你也可以加入反馈群（扫码或者点击图片跳转）</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A5%97%E9%A2%98%E4%B8%80"><span class="toc-number">1.</span> <span class="toc-text">套题一</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E%E4%B9%A6"><span class="toc-number">2.</span> <span class="toc-text">区块链食品溯源系统概要设计说明书</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%8E%E5%BC%95%E8%A8%80"><span class="toc-number">2.1.</span> <span class="toc-text">1．引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E7%BC%96%E5%86%99%E7%9B%AE%E7%9A%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1编写目的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.2.</span> <span class="toc-text">2. 总体设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E9%9C%80%E6%B1%82%E8%A7%84%E5%AE%9A"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1需求规定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%A6%81%E6%B1%82"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">2.1.2输入输出要求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2运行环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1%E6%94%AF%E6%8C%81%E6%9E%B6%E6%9E%84"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">2.2.1支持架构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E5%9F%BA%E6%9C%AC%E8%AE%BE%E8%AE%A1%E6%A6%82%E5%BF%B5%E5%92%8C%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3基本设计概念和处理流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">2.3.1 登录业务功能模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.3.1.1.</span> <span class="toc-text">登录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E9%A3%9F%E5%93%81%E8%AE%A2%E5%8D%95%E6%BA%AF%E6%BA%90%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">2.3.2 食品订单溯源功能模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A3%9F%E5%93%81%E8%AE%A2%E5%8D%95%E6%BA%AF%E6%BA%90"><span class="toc-number">2.2.3.2.1.</span> <span class="toc-text">食品订单溯源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.4结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E6%80%BB%E4%BD%93%E6%A1%86%E5%9B%BE"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">2.4.1 总体框图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E6%8E%A5%E5%8F%A3%E5%8F%8A%E8%AF%B4%E6%98%8E"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">2.4.2 功能模块接口及说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-1-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.4.2.1.</span> <span class="toc-text">2.4.2.1 用户信息查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-2-%E7%94%9F%E4%BA%A7%E8%AE%A2%E5%8D%95%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.4.2.2.</span> <span class="toc-text">2.4.2.2 生产订单创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-3-%E5%88%86%E9%94%80%E8%AE%A2%E5%8D%95%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.4.2.3.</span> <span class="toc-text">2.4.2.3 分销订单创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-4-%E9%94%80%E5%94%AE%E8%AE%A2%E5%8D%95%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.4.2.4.</span> <span class="toc-text">2.4.2.4 销售订单创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-5-%E9%A3%9F%E5%93%81%E4%BF%A1%E6%81%AF%E8%BF%BD%E6%BA%AF%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.4.2.5.</span> <span class="toc-text">2.4.2.5 食品信息追溯查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%8E%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.</span> <span class="toc-text">3．系统数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-User%E8%A1%A8%EF%BC%88user%EF%BC%89"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 User表（user）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%8E%E7%B3%BB%E7%BB%9F%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.4.</span> <span class="toc-text">4．系统出错处理设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E5%87%BA%E9%94%99%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1出错信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E8%A1%A5%E6%95%91%E6%8E%AA%E6%96%BD"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2补救措施</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3系统维护设计</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E4%B8%80"><span class="toc-number">3.</span> <span class="toc-text">模块一</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-1%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BA%A7%E5%93%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.1.</span> <span class="toc-text">任务1-1：区块链产品需求分析与方案设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-2%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-number">3.2.</span> <span class="toc-text">任务1-2：区块链系统部署与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A11-2-1%EF%BC%9A-%E6%90%AD%E5%BB%BA%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%B9%B6%E9%AA%8C%E8%AF%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">子任务1-2-1： 搭建区块链系统并验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-%E9%87%87%E7%94%A8%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%90%AD%E5%BB%BA%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BD%91%E7%BB%9C%EF%BC%9B"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">（1） 采用默认配置搭建区块链网络；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E9%AA%8C%E8%AF%81%E5%8C%BA%E5%9D%97%E9%93%BE%E8%8A%82%E7%82%B9%E8%BF%9B%E7%A8%8B%E8%BF%90%E8%A1%8C%E7%8A%B6%E5%86%B5%EF%BC%9B"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">（2） 通过命令验证区块链节点进程运行状况；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E9%AA%8C%E8%AF%81%E5%8C%BA%E5%9D%97%E9%93%BE%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81%E5%92%8C%E5%85%B1%E8%AF%86%E7%8A%B6%E6%80%81%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E3%80%82"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">（3） 通过命令验证区块链连接状态和共识状态日志输出。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A11-2-2%EF%BC%9A%E6%90%AD%E5%BB%BA%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%B9%B6%E9%AA%8C%E8%AF%81"><span class="toc-number">3.2.2.</span> <span class="toc-text">子任务1-2-2：搭建区块链系统管理平台并验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E9%85%8D%E7%BD%AE%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%8C%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E8%AF%81%E4%B9%A6%E5%B9%B6%E5%90%AF%E5%8A%A8%EF%BC%9B"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">（1）配置控制台，管理相关证书并启动；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%89%E8%A3%85HelloWorld%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%9B"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">（2）使用控制台安装HelloWorld智能合约；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%B0%86node2%E8%8A%82%E7%82%B9%E6%B7%BB%E5%8A%A0%E4%B8%BAgroup2%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E8%8A%82%E7%82%B9"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">(3)   使用控制台将node2节点添加为group2的观察者节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89-%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%8C%E6%88%90HelloWorld%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%9A%84set%E4%B8%8Eget%E6%93%8D%E4%BD%9C%EF%BC%9B"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">（4） 使用控制台完成HelloWorld智能合约的set与get操作；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89-%E4%BD%BF%E7%94%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9F%A5%E7%9C%8B%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%AD%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%EF%BC%9B"><span class="toc-number">3.2.2.5.</span> <span class="toc-text">（5） 使用控制台查看区块链中区块高度；</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A11-2-3%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E8%8A%82%E7%82%B9%E8%BF%90%E7%BB%B4"><span class="toc-number">3.2.3.</span> <span class="toc-text">子任务1-2-3：区块链节点运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E8%8A%82%E7%82%B9%E8%BE%93%E5%87%BA%E7%AD%89%E7%BA%A7%E4%B8%BA%E8%AD%A6%E5%91%8A%E7%BA%A7%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E5%AD%98%E5%82%A8%E9%98%88%E5%80%BC%E4%BD%8D100MB%E5%B9%B6%E9%AA%8C%E8%AF%81%EF%BC%9B"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">（1）获取指定区块链节点输出等级为警告级，并设置日志存储阈值位100MB并验证；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E9%80%9A%E8%BF%87%E7%BB%99%E5%AE%9A%E5%B7%A5%E5%85%B7%EF%BC%88%E5%9C%B0%E5%9D%80-root-tools%EF%BC%89%E5%AE%8C%E6%88%90%E6%96%B0%E8%8A%82%E7%82%B9%EF%BC%88node4%EF%BC%89%E9%85%8D%E7%BD%AE%EF%BC%9B"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">（2）通过给定工具（地址&#x2F;root&#x2F;tools）完成新节点（node4）配置；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%90%AF%E5%8A%A8%E6%96%B0%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%B9%B6%E9%AA%8C%E8%AF%81%E3%80%82"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">（3）启动新节点加入区块链系统并验证。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BB%BB%E5%8A%A11-2-4%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4"><span class="toc-number">3.2.4.</span> <span class="toc-text">子任务1-2-4：区块链网络运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E8%AE%BE%E7%BD%AE%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E9%BB%91%E5%90%8D%E5%8D%95%EF%BC%8C%E5%B0%86node3%E8%AE%BE%E4%B8%BA%E9%BB%91%E5%90%8D%E5%8D%95%E7%A6%81%E6%AD%A2%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%B9%B6%E9%AA%8C%E8%AF%81%EF%BC%9B"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">（1）设置区块链系统黑名单，将node3设为黑名单禁止连接，并验证；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%8C%BA%E5%9D%97%E6%89%93%E5%8C%85%E6%9C%80%E5%A4%A7%E4%BA%A4%E6%98%93%E6%95%B0%E9%87%8F%E8%AE%BE%E4%B8%BA2000%EF%BC%9B"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">（2）设置系统中区块打包最大交易数量设为2000；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E9%AA%8C%E8%AF%81%E5%8C%BA%E5%9D%97%E6%9C%80%E5%A4%A7%E6%89%93%E5%8C%85%E4%BA%A4%E6%98%93%E6%95%B0%E9%87%8F%E6%83%85%E5%86%B5"><span class="toc-number">3.2.4.3.</span> <span class="toc-text">（3）验证区块最大打包交易数量情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-3%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95"><span class="toc-number">3.3.</span> <span class="toc-text">任务1-3：区块链系统测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%90%AF%E5%8A%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E7%B3%BB%E7%BB%9F%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B8%80%E4%BD%93%E5%B9%B3%E5%8F%B0%E5%B9%B6%E9%AA%8C%E8%AF%81%E5%90%AF%E5%8A%A8%E6%83%85%E5%86%B5%EF%BC%9B"><span class="toc-number">3.3.1.</span> <span class="toc-text">1.使用命令启动区块链系统可视化一体平台并验证启动情况；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%E7%94%9F%E6%88%90%E5%8C%85%E6%8B%AC%E7%94%9F%E4%BA%A7%E5%95%86-Producer-%E3%80%81%E7%BB%8F%E9%94%80%E5%95%86-distributor-%E3%80%81%E9%9B%B6%E5%94%AE%E5%95%86-retailer-%E8%B4%A6%E6%88%B7%EF%BC%8C%E5%B9%B6%E5%B0%86%E8%B4%A6%E6%88%B7%E4%BB%A5p12%E5%8A%A0%E5%AF%86%E5%BD%A2%E5%BC%8F%E5%AF%BC%E5%87%BA%E5%90%8E%E5%80%92%E5%85%A5%E6%8C%87%E5%AE%9A%E5%89%8D%E7%BD%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0%EF%BC%8C%E9%AA%8C%E8%AF%81%E5%9C%B0%E5%9D%80%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%9B"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.通过可视化平台生成包括生产商(Producer)、经销商(distributor)、零售商(retailer)账户，并将账户以p12加密形式导出后倒入指定前置可视化平台，验证地址一致性；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8Postman%E5%AF%B9%E4%B8%8A%E8%BF%B0%E5%8A%9F%E8%83%BD%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%EF%BC%8C%E5%B9%B6%E5%B0%86%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C%E6%88%AA%E5%9B%BE%E6%8F%90%E4%BA%A4%E5%B7%A5%E7%A8%8B%E6%96%87%E6%A1%A3%E3%80%82%E5%AF%B9%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E2%80%9C%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E2%80%9D-produce-%E5%8A%9F%E8%83%BD%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%E3%80%82"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.使用Postman对上述功能接口进行验证，并将验证结果截图提交工程文档。对食品溯源系统服务端“添加食品”(&#x2F;produce)功能接口进行验证。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8F%82%E7%85%A7%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%9C%B0%E5%9D%80%EF%BC%9A%E2%80%9C-root-projects%E2%80%9D%EF%BC%89%E4%BD%BF%E7%94%A8Caliper%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%AF%B9%E9%A3%9F%E5%93%81%E5%AE%89%E5%85%A8%E6%BA%AF%E6%BA%90%E7%B3%BB%E7%BB%9F%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%94%9F%E6%88%90%E6%96%B0%E9%A3%9F%E5%93%81-newFood-%E5%8A%9F%E8%83%BD%E8%BF%9B%E8%A1%8C%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E3%80%82%E5%85%B7%E4%BD%93%E8%A6%81%E6%B1%82%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">3.3.4.</span> <span class="toc-text">4.参照工程项目（地址：“&#x2F;root&#x2F;projects”）使用Caliper测试工具对食品安全溯源系统智能合约生成新食品(newFood)功能进行压力测试。具体要求如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-%E6%8F%90%E4%BE%9B%E6%A0%B8%E5%BF%83%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81%EF%BC%9B"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">（1） 提供核心测试代码；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89-%E8%AE%BE%E7%BD%AEtxNumber-10%EF%BC%8Ctps-1%EF%BC%8C%E6%89%80%E6%9C%89%E6%B5%8B%E8%AF%95%E9%80%9A%E8%BF%87%E7%8E%87%E4%B8%BA100"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">（2） 设置txNumber&#x3D;10，tps&#x3D;1，所有测试通过率为100%</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%B5%8B%E8%AF%95%E3%80%82"><span class="toc-number">3.3.5.</span> <span class="toc-text">5.智能合约安全漏洞测试。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-%E5%88%86%E6%9E%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%B8%AD%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%EF%BC%8C%E5%B9%B6%E8%AF%B4%E6%98%8E%E5%8D%B1%E5%AE%B3%EF%BC%9B"><span class="toc-number">3.3.5.0.1.</span> <span class="toc-text">（1） 分析智能合约中存在问题，并说明危害；</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89-%E6%A0%B9%E6%8D%AE%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%EF%BC%8C%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%EF%BC%8C%E5%A4%8D%E7%8E%B0%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%B8%AD%E5%AD%98%E5%9C%A8%E7%9A%84%E6%BC%8F%E6%B4%9E%EF%BC%9B"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">（2） 根据测试工具中的代码文件，编写测试用例，复现智能合约中存在的漏洞；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%8C%E4%BF%AE%E5%A4%8D%E5%85%B6%E4%B8%AD%E9%97%AE%E9%A2%98%EF%BC%8C%E8%AF%B4%E6%98%8E%E4%BF%AE%E5%A4%8D%E5%86%85%E5%AE%B9%E5%B9%B6%E6%B5%8B%E8%AF%95%E3%80%82"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">（3） 创建新的智能合约，修复其中问题，说明修复内容并测试。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E4%BA%8C"><span class="toc-number">4.</span> <span class="toc-text">模块二</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-1%EF%BC%9A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.1.</span> <span class="toc-text">任务2-1：智能合约设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.编写区块链食品溯源智能合约功能需求文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">功能需求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%8C%E6%88%90%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%9B%BE"><span class="toc-number">4.1.2.</span> <span class="toc-text">2.完成区块链食品溯源智能合约的设计图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BE%8B%E5%9B%BE"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">用例图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">时序图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-2%EF%BC%9A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91"><span class="toc-number">4.2.</span> <span class="toc-text">任务2-2：智能合约开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A3%9F%E5%93%81%E4%BF%A1%E6%81%AF%EF%BC%88FoodInfoItem%EF%BC%89%E7%9A%84%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.1.</span> <span class="toc-text">1.食品信息（FoodInfoItem）的接口编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E4%BF%A1%E6%81%AF%E5%AE%9E%E4%BD%93%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">（1）编写食品信息实体的接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%BC%96%E5%86%99%E5%88%86%E9%94%80%E5%95%86%E9%A3%9F%E5%93%81%E4%B8%8A%E9%93%BE%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.1.3.</span> <span class="toc-text">（2）编写分销商食品上链信息接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-1"><span class="toc-number">4.2.1.4.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E7%BC%96%E5%86%99%E8%B6%85%E5%B8%82%E8%BF%9B%E8%A1%8C%E9%A3%9F%E5%93%81%E4%B8%8A%E9%93%BE%E4%BF%A1%E6%81%AF%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.1.5.</span> <span class="toc-text">（3）编写超市进行食品上链信息的接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-2"><span class="toc-number">4.2.1.6.</span> <span class="toc-text">答案：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90-Trace-%E7%9A%84%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.食品溯源(Trace)的接口编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%94%9F%E4%BA%A7%E5%95%86Producer%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">（1）编写食品溯源智能合约生产商Producer添加食品接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-3"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%86%E9%94%80%E5%95%86Distributor%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.3.</span> <span class="toc-text">（2）编写食品溯源智能合约分销商Distributor添加食品接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88"><span class="toc-number">4.2.2.4.</span> <span class="toc-text">答案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%B6%85%E5%B8%82Retailer%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.2.5.</span> <span class="toc-text">（3）编写食品溯源智能合约超市Retailer添加食品接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-4"><span class="toc-number">4.2.2.6.</span> <span class="toc-text">答案：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%A7%92%E8%89%B2%EF%BC%88Role%EF%BC%89%E7%AE%A1%E7%90%86%E7%9A%84%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.3.</span> <span class="toc-text">3.角色（Role）管理的接口编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E5%A2%9E%E5%8A%A0%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">（1）编写食品溯源增加角色接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-5"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E7%A7%BB%E9%99%A4%E8%A7%92%E8%89%B2%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.3.3.</span> <span class="toc-text">（2）编写食品溯源移除角色接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-1"><span class="toc-number">4.2.3.4.</span> <span class="toc-text">答案:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E7%BC%96%E5%86%99%E9%A3%9F%E5%93%81%E6%BA%AF%E6%BA%90%E8%A7%92%E8%89%B2%E6%8E%88%E6%9D%83%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.3.5.</span> <span class="toc-text">（3）编写食品溯源角色授权接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-6"><span class="toc-number">4.2.3.6.</span> <span class="toc-text">答案：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%90%88%E7%BA%A6%E7%BC%96%E8%AF%91%E3%80%81%E9%83%A8%E7%BD%B2%E5%92%8C%E8%B0%83%E7%94%A8"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.合约编译、部署和调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%90%88%E7%BA%A6%E5%9C%B0%E5%9D%80-abi"><span class="toc-number">4.2.4.1.</span> <span class="toc-text">（1）合约地址 &amp; abi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%90%88%E7%BA%A6%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.4.2.</span> <span class="toc-text">（2）合约接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-newFood-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.2.4.2.1.</span> <span class="toc-text">调用 newFood 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-addTraceInfoByDistributor-%EF%BC%9A"><span class="toc-number">4.2.4.2.2.</span> <span class="toc-text">调用 addTraceInfoByDistributor ：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-addTraceInfoByRetailer-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.2.4.2.3.</span> <span class="toc-text">调用 addTraceInfoByRetailer 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-getFood-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.2.4.2.4.</span> <span class="toc-text">调用 getFood 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-getTraceInfo-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.2.4.2.5.</span> <span class="toc-text">调用 getTraceInfo 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-getAllFood-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.2.4.2.6.</span> <span class="toc-text">调用 getAllFood 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link"><span class="toc-number">4.2.4.2.7.</span> <span class="toc-text"></span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-3%EF%BC%9A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.</span> <span class="toc-text">任务2-3：智能合约测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E4%B8%89"><span class="toc-number">5.</span> <span class="toc-text">模块三</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A13-1%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">5.1.</span> <span class="toc-text">任务3-1：区块链应用前端功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8E%E8%AF%B7%E5%9F%BA%E4%BA%8E%E5%89%8D%E7%AB%AF%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%A8%A1%E6%9D%BF%EF%BC%8C%E5%9C%A8%E7%99%BB%E5%BD%95%E7%BB%84%E4%BB%B6login-js%E3%80%81%E7%BB%84%E4%BB%B6%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6components-js%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%89%8D%E7%AB%AF%E7%9A%84%E8%A7%92%E8%89%B2%E9%80%89%E6%8B%A9%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%B9%B6%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%95%B4%E6%80%A7%EF%BC%8C%E7%A4%BA%E4%BE%8B%E9%A1%B5%E9%9D%A2%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">5.1.1.</span> <span class="toc-text">1．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99Login-js"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">填写Login.js:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-2"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">答案:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99Login-js-1"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">填写Login.js:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-7"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99component-js"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">填写component.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-8"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">答案：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8E%E8%AF%B7%E5%9F%BA%E4%BA%8E%E5%89%8D%E7%AB%AF%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%A8%A1%E6%9D%BF%EF%BC%8C%E5%9C%A8%E7%99%BB%E5%BD%95%E7%BB%84%E4%BB%B6login-js%E3%80%81%E7%BB%84%E4%BB%B6%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6components-js%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%89%8D%E7%AB%AF%E7%9A%84%E8%A7%92%E8%89%B2%E9%80%89%E6%8B%A9%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%B9%B6%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%95%B4%E6%80%A7%EF%BC%8C%E7%A4%BA%E4%BE%8B%E9%A1%B5%E9%9D%A2%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">5.1.2.</span> <span class="toc-text">2．请基于前端系统的开发模板，在登录组件login.js、组件管理文件components.js中添加对应的逻辑代码，实现对前端的角色选择功能，并测试功能完整性，示例页面如下：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99Login-js-2"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">填写Login.js:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-9"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99Login-js-3"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">填写Login.js:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-3"><span class="toc-number">5.1.2.4.</span> <span class="toc-text">答案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99Login-js-4"><span class="toc-number">5.1.2.5.</span> <span class="toc-text">填写Login.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%EF%BC%9A-10"><span class="toc-number">5.1.2.6.</span> <span class="toc-text">答案：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A13-2%EF%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BA%94%E7%94%A8%E5%90%8E%E7%AB%AF%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">5.2.</span> <span class="toc-text">任务3-2：区块链应用后端功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%8E%E8%AF%B7%E5%9F%BA%E4%BA%8E%E5%B7%B2%E6%9C%89%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E5%AE%8C%E5%96%84IndexController%E7%B1%BB%EF%BC%8C%E7%BC%96%E5%86%99%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E7%94%9F%E4%BA%A7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%9E%E7%8E%B0%E9%A3%9F%E5%93%81%E4%BF%A1%E6%81%AF%E7%9A%84%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%B9%B6%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%95%B4%E6%80%A7%E3%80%82"><span class="toc-number">5.2.1.</span> <span class="toc-text">1．请基于已有的项目，开发完善IndexController类，编写添加食品生产信息的方法，实现食品信息的添加功能，并测试功能完整性。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99produce%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">填写produce方法:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#producer%E7%AD%94%E6%A1%88%EF%BC%9A"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">producer答案：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">postman测试：正确的添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">5.2.1.4.</span> <span class="toc-text">postman测试：错误的添加</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%8E%E5%BC%80%E5%8F%91%E5%AE%8C%E5%96%84IndexController%E7%B1%BB%EF%BC%8C%E7%BC%96%E5%86%99%E4%B8%AD%E9%97%B4%E5%95%86%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E6%B5%81%E8%BD%AC%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%B8%AD%E9%97%B4%E5%95%86%E6%B7%BB%E5%8A%A0%E9%A3%9F%E5%93%81%E6%B5%81%E8%BD%AC%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%B9%B6%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%95%B4%E6%80%A7%E3%80%82"><span class="toc-number">5.2.2.</span> <span class="toc-text">2．开发完善IndexController类，编写中间商添加食品流转信息的方法，实现中间商添加食品流转信息的功能，并测试功能完整性。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99add-trace-by-distrubutor%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">填写add_trace_by_distrubutor方法:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-4"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">答案:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%B7%BB%E5%8A%A0-1"><span class="toc-number">5.2.2.3.</span> <span class="toc-text">postman测试：正确的添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%B7%BB%E5%8A%A0-1"><span class="toc-number">5.2.2.4.</span> <span class="toc-text">postman测试：错误的添加</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%8E%E8%AF%B7%E5%9F%BA%E4%BA%8E%E5%B7%B2%E6%9C%89%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%BC%80%E5%8F%91%E5%AE%8C%E5%96%84IndexController%E7%B1%BB%EF%BC%8C%E7%BC%96%E5%86%99%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E9%A3%9F%E5%93%81%E7%9A%84%E6%BA%AF%E6%BA%90%E4%BF%A1%E6%81%AF%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%9E%E7%8E%B0%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E9%A3%9F%E5%93%81%E7%9A%84%E6%BA%AF%E6%BA%90%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%B9%B6%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%95%B4%E6%80%A7%E3%80%82"><span class="toc-number">5.2.3.</span> <span class="toc-text">3．请基于已有的项目，开发完善IndexController类，编写获取某个食品的溯源信息的方法，实现获取某个食品的溯源信息的功能，并测试功能完整性。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99trace%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">填写trace方法:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-5"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">答案:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A1%AB%E5%86%99get-trace%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">5.2.3.3.</span> <span class="toc-text">填写get_trace方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%94%E6%A1%88-6"><span class="toc-number">5.2.3.4.</span> <span class="toc-text">答案:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.3.5.</span> <span class="toc-text">postman测试：正确的查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postman%E6%B5%8B%E8%AF%95%EF%BC%9A%E9%94%99%E8%AF%AF%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.3.6.</span> <span class="toc-text">postman测试：错误的查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81%EF%BC%88%E9%83%A8%E5%88%86%E4%BF%AE%E6%94%B9%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">全部代码（部分修改）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%EF%BC%9A"><span class="toc-number">5.3.1.</span> <span class="toc-text">前端：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#components-js"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">components.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#login-js"><span class="toc-number">5.3.1.2.</span> <span class="toc-text">login.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main-js"><span class="toc-number">5.3.1.3.</span> <span class="toc-text">main.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index-js"><span class="toc-number">5.3.1.4.</span> <span class="toc-text">index.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index-html"><span class="toc-number">5.3.1.5.</span> <span class="toc-text">index.html</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%EF%BC%9A"><span class="toc-number">5.3.2.</span> <span class="toc-text">后端：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#conf-properties"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">conf.properties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IndexController-java"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">IndexController.java</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/04/music/" title="无标题"><img src="/img/%E5%B0%81%E9%9D%A2/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无标题"/></a><div class="content"><a class="title" href="/2025/01/04/music/" title="无标题">无标题</a><time datetime="2025-01-03T16:28:52.898Z" title="发表于 2025-01-04 00:28:52">2025-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/%E5%A5%97%E9%A2%98%E4%B8%80/" title="区块链 套题一"><img src="/img/%E5%B0%81%E9%9D%A2/13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="区块链 套题一"/></a><div class="content"><a class="title" href="/2025/01/03/%E5%A5%97%E9%A2%98%E4%B8%80/" title="区块链 套题一">区块链 套题一</a><time datetime="2025-01-03T14:25:25.650Z" title="发表于 2025-01-03 22:25:25">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/docker-compose/" title="Docker 私有仓库"><img src="/img/%E5%B0%81%E9%9D%A2/6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 私有仓库"/></a><div class="content"><a class="title" href="/2025/01/03/docker-compose/" title="Docker 私有仓库">Docker 私有仓库</a><time datetime="2025-01-03T07:35:19.269Z" title="发表于 2025-01-03 15:35:19">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/docker%20%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/" title="Docker 私有仓库"><img src="/img/%E5%B0%81%E9%9D%A2/5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 私有仓库"/></a><div class="content"><a class="title" href="/2025/01/03/docker%20%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/" title="Docker 私有仓库">Docker 私有仓库</a><time datetime="2025-01-03T07:35:15.387Z" title="发表于 2025-01-03 15:35:15">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/" title="图书管理系统的需求文档"><img src="/img/%E5%B0%81%E9%9D%A2/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="图书管理系统的需求文档"/></a><div class="content"><a class="title" href="/2025/01/03/%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%9C%80%E6%B1%82%E6%96%87%E6%A1%A3/" title="图书管理系统的需求文档">图书管理系统的需求文档</a><time datetime="2025-01-03T07:34:09.241Z" title="发表于 2025-01-03 15:34:09">2025-01-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 阿泽</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" onclick="switchNightMode()" title="日间和夜间模式切换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"><i class="fas fa-adjust"></i></use></svg></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"> </i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: '',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.isPost && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script async src="//at.alicdn.com/t/font_2032782_ev6ytrh30f.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script async src="/js/sun_moon.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = { startHidden: true }
  
    window.chatBtnFn = () => {
      document.getElementById('chatra').classList.contains('chatra--expanded') ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => Chatra('hide'),
      show: () => Chatra('show')
    }
  }

  (function(d, w, c) {
    w.ChatraID = ''
    var s = d.createElement('script')
    w[c] = w[c] || function() {
      (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>